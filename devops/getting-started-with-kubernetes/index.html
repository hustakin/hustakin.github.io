
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <link rel="canonical" href="https://hustakin.github.io/devops/getting-started-with-kubernetes/">
      
      
        <meta name="author" content="Frankie Fan">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.0.1">
    
    
      
        <title>Getting started with Kubernetes - Frankie Fan's Memos</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.38780c08.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f72e892.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-146443611-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview",document.location.pathname)})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="teal">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#install-on-linux-cluster" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://hustakin.github.io" title="Frankie Fan's Memos" class="md-header-nav__button md-logo" aria-label="Frankie Fan's Memos">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Frankie Fan's Memos
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Getting started with Kubernetes
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://hustakin.github.io" title="Frankie Fan's Memos" class="md-nav__button md-logo" aria-label="Frankie Fan's Memos">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Frankie Fan's Memos
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      DevOps
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="DevOps" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        DevOps
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../important-linux-commands/" title="Important linux commands" class="md-nav__link">
      Important linux commands
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../important-docker-commands/" title="Important Docker commands" class="md-nav__link">
      Important Docker commands
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Getting started with Kubernetes
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" title="Getting started with Kubernetes" class="md-nav__link md-nav__link--active">
      Getting started with Kubernetes
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#install-on-linux-cluster" class="md-nav__link">
    Install on linux cluster
  </a>
  
    <nav class="md-nav" aria-label="Install on linux cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compile-kubernetes" class="md-nav__link">
    Compile kubernetes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-master-node" class="md-nav__link">
    Install master node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-slave-node" class="md-nav__link">
    Install slave node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-metrics-server" class="md-nav__link">
    Install metrics server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-prometheus" class="md-nav__link">
    Install prometheus
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-helm" class="md-nav__link">
    Install helm
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#traefik" class="md-nav__link">
    Traefik
  </a>
  
    <nav class="md-nav" aria-label="Traefik">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-traefik-toml" class="md-nav__link">
    Create Traefik toml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-traefik-yaml" class="md-nav__link">
    Create Traefik yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-traefik-rbac" class="md-nav__link">
    Create Traefik rbac
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-traefik-web-ui-ingress" class="md-nav__link">
    Create Traefik web-ui ingress
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-traefik-https-cert" class="md-nav__link">
    Create Traefik HTTPS cert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#renew-traefik-https-cert" class="md-nav__link">
    Renew Traefik HTTPS cert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-traefiktoml" class="md-nav__link">
    Update Traefik.toml
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubernetes-dashboard-for-local" class="md-nav__link">
    Kubernetes Dashboard for local
  </a>
  
    <nav class="md-nav" aria-label="Kubernetes Dashboard for local">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-service-account" class="md-nav__link">
    Create service account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-role-binding" class="md-nav__link">
    Create role binding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apply-yaml" class="md-nav__link">
    Apply yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieve-login-token" class="md-nav__link">
    Retrieve login token
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-dashboard" class="md-nav__link">
    Install dashboard
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubernetes-dashboard-for-public" class="md-nav__link">
    Kubernetes Dashboard for public
  </a>
  
    <nav class="md-nav" aria-label="Kubernetes Dashboard for public">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-certificates" class="md-nav__link">
    Create certificates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-dashboard_1" class="md-nav__link">
    Install dashboard
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-psp" class="md-nav__link">
    Create PSP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-role" class="md-nav__link">
    Create role
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bind-role-and-account" class="md-nav__link">
    Bind role and account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expose-service-on-nodeport" class="md-nav__link">
    Expose service on NodePort
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#navigate-the-dashboard-publicly" class="md-nav__link">
    Navigate the dashboard publicly
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expose-traefik-ingress" class="md-nav__link">
    Expose Traefik ingress
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scenarios" class="md-nav__link">
    Scenarios
  </a>
  
    <nav class="md-nav" aria-label="Scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-a-busybox-container" class="md-nav__link">
    Run a busybox container
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-docker-hub-secret-in-pods" class="md-nav__link">
    User docker hub secret in pods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-storage-class" class="md-nav__link">
    Default storage class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-mongodb-with-two-db-auth-settings" class="md-nav__link">
    Create MongoDB with two DB auth settings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-commands" class="md-nav__link">
    Useful commands
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../amazon-ec2-101/" title="Amazon EC2 101" class="md-nav__link">
      Amazon EC2 101
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../getting-started-with-vagrant/" title="Getting started with Vagrant" class="md-nav__link">
      Getting started with Vagrant
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../things-todo-after-installing-ubuntu/" title="Things to do after installing Ubuntu 20.04.1 LTS" class="md-nav__link">
      Things to do after installing Ubuntu 20.04.1 LTS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Best Practice
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Best Practice" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Best Practice
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../bestpractice/setup-vncserver-for-ubuntu/" title="Using VNC to Operate a Desktop on Ubuntu 18.04" class="md-nav__link">
      Using VNC to Operate a Desktop on Ubuntu 18.04
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bestpractice/integrate-google-analytics-with-web-app/" title="Integrate Google Analytics with a web application" class="md-nav__link">
      Integrate Google Analytics with a web application
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bestpractice/adding-beautiful-badges-into-the-markdown/" title="Adding beautiful badges into the markdown" class="md-nav__link">
      Adding beautiful badges into the markdown
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bestpractice/setup-jenkins-pipeline-in-kubernetes/" title="Setup Jenkins Pipeline and Blue Ocean in Kubernetes" class="md-nav__link">
      Setup Jenkins Pipeline and Blue Ocean in Kubernetes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bestpractice/continuous-integration-with-jenkins-and-docker/" title="Continuous Integration with Jenkins and Docker" class="md-nav__link">
      Continuous Integration with Jenkins and Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bestpractice/introduce-rollbar-and-slack-for-realtime-exception-alerts/" title="Introduce Rollbar and Slack for realtime exception alerts" class="md-nav__link">
      Introduce Rollbar and Slack for realtime exception alerts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bestpractice/create--app-icon-launch-screen-for-flutter/" title="How to create an app icon and launch screen for flutter" class="md-nav__link">
      How to create an app icon and launch screen for flutter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bestpractice/auto-generate-flutter-imgs/" title="Generate required flutter app screenshots for different devices" class="md-nav__link">
      Generate required flutter app screenshots for different devices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bestpractice/flutter-app-distribution-for-testing/" title="How to make flutter app distribution for testing in Firebase" class="md-nav__link">
      How to make flutter app distribution  for testing in Firebase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bestpractice/keycloak-traefik-k8s/" title="Play around with Keycloak in k8s" class="md-nav__link">
      Play around with Keycloak in k8s
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bestpractice/developing-based-on-geoserver-restful-api/" title="Developing based on GeoServer restful api" class="md-nav__link">
      Developing based on GeoServer restful api
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bestpractice/serve-raster-tiles-in-geoserver/" title="Serve raster tiles in GeoServer" class="md-nav__link">
      Serve raster tiles in GeoServer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bestpractice/build-ceph-and-k8s-based-distributed-file-storage-system/" title="Build Ceph and Kubernetes based distributed file storage system" class="md-nav__link">
      Build Ceph and Kubernetes based distributed file storage system
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Tools 101
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Tools 101" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Tools 101
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tools/hexo-get-started/" title="Hexo get started" class="md-nav__link">
      Hexo get started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tools/getting-started-with-mitmproxy/" title="Getting started on mitmproxy" class="md-nav__link">
      Getting started on mitmproxy
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Life Experience
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Life Experience" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Life Experience
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../life/how-to-rent-a-house-in-australia/" title="How to rent a house in Australia" class="md-nav__link">
      How to rent a house in Australia
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../life/international-money-transfer-from-commanwealth-bank-to-china/" title="International money transfer from CommonWealth bank to China" class="md-nav__link">
      International money transfer from CommonWealth bank to China
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../life/a-detail-list-for-updating-address-when-moving/" title="A detailed list for updating address when moving" class="md-nav__link">
      A detailed list for updating address when moving
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#install-on-linux-cluster" class="md-nav__link">
    Install on linux cluster
  </a>
  
    <nav class="md-nav" aria-label="Install on linux cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compile-kubernetes" class="md-nav__link">
    Compile kubernetes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-master-node" class="md-nav__link">
    Install master node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-slave-node" class="md-nav__link">
    Install slave node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-metrics-server" class="md-nav__link">
    Install metrics server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-prometheus" class="md-nav__link">
    Install prometheus
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-helm" class="md-nav__link">
    Install helm
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#traefik" class="md-nav__link">
    Traefik
  </a>
  
    <nav class="md-nav" aria-label="Traefik">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-traefik-toml" class="md-nav__link">
    Create Traefik toml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-traefik-yaml" class="md-nav__link">
    Create Traefik yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-traefik-rbac" class="md-nav__link">
    Create Traefik rbac
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-traefik-web-ui-ingress" class="md-nav__link">
    Create Traefik web-ui ingress
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-traefik-https-cert" class="md-nav__link">
    Create Traefik HTTPS cert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#renew-traefik-https-cert" class="md-nav__link">
    Renew Traefik HTTPS cert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-traefiktoml" class="md-nav__link">
    Update Traefik.toml
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubernetes-dashboard-for-local" class="md-nav__link">
    Kubernetes Dashboard for local
  </a>
  
    <nav class="md-nav" aria-label="Kubernetes Dashboard for local">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-service-account" class="md-nav__link">
    Create service account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-role-binding" class="md-nav__link">
    Create role binding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apply-yaml" class="md-nav__link">
    Apply yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieve-login-token" class="md-nav__link">
    Retrieve login token
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-dashboard" class="md-nav__link">
    Install dashboard
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubernetes-dashboard-for-public" class="md-nav__link">
    Kubernetes Dashboard for public
  </a>
  
    <nav class="md-nav" aria-label="Kubernetes Dashboard for public">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-certificates" class="md-nav__link">
    Create certificates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-dashboard_1" class="md-nav__link">
    Install dashboard
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-psp" class="md-nav__link">
    Create PSP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-role" class="md-nav__link">
    Create role
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bind-role-and-account" class="md-nav__link">
    Bind role and account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expose-service-on-nodeport" class="md-nav__link">
    Expose service on NodePort
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#navigate-the-dashboard-publicly" class="md-nav__link">
    Navigate the dashboard publicly
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expose-traefik-ingress" class="md-nav__link">
    Expose Traefik ingress
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scenarios" class="md-nav__link">
    Scenarios
  </a>
  
    <nav class="md-nav" aria-label="Scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-a-busybox-container" class="md-nav__link">
    Run a busybox container
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-docker-hub-secret-in-pods" class="md-nav__link">
    User docker hub secret in pods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-storage-class" class="md-nav__link">
    Default storage class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-mongodb-with-two-db-auth-settings" class="md-nav__link">
    Create MongoDB with two DB auth settings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-commands" class="md-nav__link">
    Useful commands
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Getting started with Kubernetes</h1>
                
                <p>Kubernetes (K8s) is an open-source system for automating deployment, scaling, and management of containerized applications.</p>
<p>It groups containers that make up an application into logical units for easy management and discovery. Kubernetes builds upon 15 years of experience of running production workloads at Google, combined with best-of-breed ideas and practices from the community.</p>
<p><img alt="Kubernetes" src="/imgs/kubernetes.png" />
<!-- more --></p>
<h2 id="install-on-linux-cluster">Install on linux cluster</h2>
<h3 id="compile-kubernetes">Compile kubernetes</h3>
<div class="highlight"><pre><span></span><code>git clone https://github.com/kubernetes/kubernetes.git
<span class="nb">cd</span> kubernetes
make release
</code></pre></div>

<h3 id="install-master-node">Install master node</h3>
<div class="highlight"><pre><span></span><code><span class="c1">#Add repos</span>
cat <span class="s">&lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span>
<span class="s">[kubernetes]</span>
<span class="s">name=Kubernetes</span>
<span class="s">baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64</span>
<span class="s">enabled=1</span>
<span class="s">gpgcheck=1</span>
<span class="s">repo_gpgcheck=1</span>
<span class="s">gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg</span>
<span class="s">exclude=kube*</span>
<span class="s">EOF</span>

<span class="c1">#Set SELinux in permissive mode (effectively disabling it)</span>
setenforce <span class="m">0</span>
sed -i <span class="s1">&#39;s/^SELINUX=enforcing$/SELINUX=permissive/&#39;</span> /etc/selinux/config

<span class="c1">#Install</span>
yum install -y kubelet kubeadm kubectl --disableexcludes<span class="o">=</span>kubernetes
systemctl <span class="nb">enable</span> --now kubelet

cat <span class="s">&lt;&lt;EOF &gt;  /etc/sysctl.d/k8s.conf</span>
<span class="s">net.bridge.bridge-nf-call-ip6tables = 1</span>
<span class="s">net.bridge.bridge-nf-call-iptables = 1</span>
<span class="s">EOF</span>
sysctl --system

<span class="c1">#Install network plugin</span>
sudo kubeadm init --pod-network-cidr<span class="o">=</span><span class="m">192</span>.168.0.0/16
kubectl apply -f https://docs.projectcalico.org/v3.3/getting-started/kubernetes/installation/hosted/rbac-kdd.yamlrm 
kubectl apply -f https://docs.projectcalico.org/v3.3/getting-started/kubernetes/installation/hosted/kubernetes-datastore/calico-networking/1.7/calico.yaml

<span class="c1">#Copy kubernetes config to user folder</span>
mkdir -p <span class="nv">$HOME</span>/.kube
sudo cp -i /etc/kubernetes/admin.conf <span class="nv">$HOME</span>/.kube/config
sudo chown <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> <span class="nv">$HOME</span>/.kube/config
</code></pre></div>

<h3 id="install-slave-node">Install slave node</h3>
<div class="highlight"><pre><span></span><code><span class="c1">#Run on master node to get the join commands</span>
sudo kubeadm token create --print-join-command

<span class="c1">#Copy the join commands and run on slave node</span>
kubeadm join &lt;master-ip&gt;:6443 --token 2kjo2d.8qno0vzvbgabp1e8 --discovery-token-ca-cert-hash sha256:2f1ebea7d7369a2d18b58f2926573e193e13ef7525649df1740ddb87963e1315
</code></pre></div>

<h3 id="install-metrics-server">Install metrics server</h3>
<div class="highlight"><pre><span></span><code>git clone https://github.com/kodekloudhub/kubernetes-metrics-server.git
kubectl create -f kubernetes-metrics-server/
kubectl top nodes
kubectl top pods
</code></pre></div>

<h3 id="install-prometheus">Install prometheus</h3>
<div class="highlight"><pre><span></span><code>kubectl apply --filename https://raw.githubusercontent.com/giantswarm/kubernetes-prometheus/master/manifests-all.yaml
<span class="c1">#Maybe you should download the manifests-all.yaml and customize it yourself. For example, you would add Grafana configuration in it.</span>
<span class="c1">#Create Traefik ingress yaml and apply</span>
</code></pre></div>

<h3 id="install-helm">Install helm</h3>
<div class="highlight"><pre><span></span><code><span class="c1">#Download helm tar.gz file from https://github.com/helm/helm/releases</span>
tar -zxvf helm-v2.14.1-linux-amd64.tar.gz
sudo cp linux-amd64/helm /usr/local/bin
helm init
helm version
kubectl get pod -n kube-system -l <span class="nv">app</span><span class="o">=</span>helm
kubectl create -f rbac.yml
kubectl patch deploy --namespace kube-system tiller-deploy -p <span class="s1">&#39;{&quot;spec&quot;:{&quot;template&quot;:{&quot;spec&quot;:{&quot;serviceAccount&quot;:&quot;tiller&quot;}}}}&#39;</span>
</code></pre></div>

<h2 id="traefik">Traefik</h2>
<h3 id="create-traefik-toml">Create Traefik toml</h3>
<div class="highlight"><pre><span></span><code><span class="n">defaultEntryPoints</span> <span class="o">=</span> <span class="k">[&quot;http&quot;,&quot;https&quot;]</span>
<span class="c1"># Enable inner-cluster https navigation</span>
<span class="n">insecureSkipVerify</span> <span class="o">=</span> <span class="kc">true</span>
<span class="k">[entryPoints]</span>
  <span class="k">[entryPoints.http]</span>
  <span class="n">address</span> <span class="o">=</span> <span class="s">&quot;:80&quot;</span>
    <span class="k">[entryPoints.http.redirect]</span>
    <span class="n">entryPoint</span> <span class="o">=</span> <span class="s">&quot;https&quot;</span>
  <span class="k">[entryPoints.https]</span>
  <span class="n">address</span> <span class="o">=</span> <span class="s">&quot;:443&quot;</span>
    <span class="k">[entryPoints.https.tls]</span>
      <span class="k">[[entryPoints.https.tls.certificates]]</span>
      <span class="n">certFile</span> <span class="o">=</span> <span class="s">&quot;/etc/kubernetes/ssl/cert.pem&quot;</span>
      <span class="n">keyFile</span> <span class="o">=</span> <span class="s">&quot;/etc/kubernetes/ssl/privkey.pem&quot;</span>
<span class="k">[metrics]</span>
  <span class="k">[metrics.prometheus]</span>
    <span class="n">entryPoint</span> <span class="o">=</span> <span class="s">&quot;traefik&quot;</span>
    <span class="n">buckets</span> <span class="o">=</span> <span class="k">[0.1, 0.3, 1.2, 5.0]</span>
</code></pre></div>

<h3 id="create-traefik-yaml">Create Traefik yaml</h3>
<div class="highlight"><pre><span></span><code><span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">traefik-ingress-controller</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">k8s-app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">traefik-ingress-lb</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">replicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="nt">selector</span><span class="p">:</span>
    <span class="nt">matchLabels</span><span class="p">:</span>
      <span class="nt">k8s-app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">traefik-ingress-lb</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">metadata</span><span class="p">:</span>
      <span class="nt">labels</span><span class="p">:</span>
        <span class="nt">k8s-app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">traefik-ingress-lb</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">traefik-ingress-lb</span>
    <span class="nt">spec</span><span class="p">:</span>
      <span class="nt">serviceAccountName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">traefik-ingress-controller</span>
      <span class="nt">terminationGracePeriodSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">60</span>
      <span class="nt">tolerations</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">operator</span><span class="p">:</span> <span class="s">&quot;Exists&quot;</span>
      <span class="nt">nodeSelector</span><span class="p">:</span>
        <span class="nt">node</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">master</span>
      <span class="nt">volumes</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ssl</span>
          <span class="nt">secret</span><span class="p">:</span>
            <span class="nt">secretName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">traefik-cert</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">config</span>
          <span class="nt">configMap</span><span class="p">:</span>
            <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">traefik-conf</span>
      <span class="nt">containers</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">traefik</span>
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">traefik-ingress-lb</span>
          <span class="nt">volumeMounts</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">mountPath</span><span class="p">:</span> <span class="s">&quot;/etc/kubernetes/ssl&quot;</span>
              <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;ssl&quot;</span>
            <span class="p p-Indicator">-</span> <span class="nt">mountPath</span><span class="p">:</span> <span class="s">&quot;/home/ec2-user/kube/traefik&quot;</span>
              <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;config&quot;</span>
          <span class="nt">ports</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http</span>
              <span class="nt">containerPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
              <span class="nt">hostPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https</span>
              <span class="nt">containerPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">443</span>
              <span class="nt">hostPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">443</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">admin</span>
              <span class="nt">containerPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
          <span class="nt">args</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--api</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--kubernetes</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--logLevel=INFO</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--configfile=/home/ec2-user/kube/traefik/traefik.toml</span>
<span class="nn">---</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">traefik-ingress-service</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">selector</span><span class="p">:</span>
    <span class="nt">k8s-app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">traefik-ingress-lb</span>
  <span class="nt">ports</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">protocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
      <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">web</span>
    <span class="p p-Indicator">-</span> <span class="nt">protocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
      <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">443</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https</span>
    <span class="p p-Indicator">-</span> <span class="nt">protocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
      <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">admin</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">NodePort</span>
</code></pre></div>

<h3 id="create-traefik-rbac">Create Traefik rbac</h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">traefik-ingress-controller</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="nn">---</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1beta1</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">traefik-ingress-controller</span>
<span class="nt">rules</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">apiGroups</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="s">&quot;&quot;</span>
    <span class="nt">resources</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">services</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">endpoints</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">secrets</span>
    <span class="nt">verbs</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">get</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">list</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">watch</span>
  <span class="p p-Indicator">-</span> <span class="nt">apiGroups</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">extensions</span>
    <span class="nt">resources</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ingresses</span>
    <span class="nt">verbs</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">get</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">list</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">watch</span>
<span class="nn">---</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1beta1</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">traefik-ingress-controller</span>
<span class="nt">roleRef</span><span class="p">:</span>
  <span class="nt">apiGroup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
  <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">traefik-ingress-controller</span>
<span class="nt">subjects</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">traefik-ingress-controller</span>
    <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
</code></pre></div>

<h3 id="create-traefik-web-ui-ingress">Create Traefik web-ui ingress</h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">traefik-web-ui</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
  <span class="nt">annotations</span><span class="p">:</span>
    <span class="nt">kubernetes.io/ingress.class</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">traefik</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">rules</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">host</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">domain</span><span class="p p-Indicator">]</span>
      <span class="nt">http</span><span class="p">:</span>
        <span class="nt">paths</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nt">backend</span><span class="p">:</span>
              <span class="nt">serviceName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">traefik-ingress-service</span>
              <span class="nt">servicePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
</code></pre></div>

<h3 id="create-traefik-https-cert">Create Traefik HTTPS cert</h3>
<div class="highlight"><pre><span></span><code>sudo -s
<span class="nb">cd</span> /etc/letsencrypt/live/<span class="o">[</span>domain<span class="o">]</span>
<span class="c1">#Update https cert keys and go to domain management console to modify the txt record</span>
kubectl create secret generic traefik-cert --from-file<span class="o">=</span>privkey.pem --from-file<span class="o">=</span>cert.pem -n kube-system
cp cert.pem privkey.pem /etc/kubernetes/ssl/
<span class="c1">#exit and go to the traefik k8s scripts folder</span>
kubectl create configmap traefik-conf --from-file<span class="o">=</span>traefik.toml -n kube-system
kubectl get cm -n kube-system
</code></pre></div>

<h3 id="renew-traefik-https-cert">Renew Traefik HTTPS cert</h3>
<div class="highlight"><pre><span></span><code>kubectl delete secret traefik-cert -n kube-system
kubectl delete configmap traefik-conf -n kube-system
kubectl delete -f traefik.yml
<span class="c1">#Re-run the above &quot;Create Traefik HTTPS cert&quot; steps</span>
kubectl create -f traefik.yml
</code></pre></div>

<h3 id="update-traefiktoml">Update Traefik.toml</h3>
<div class="highlight"><pre><span></span><code><span class="c1">#Firstly modify the traefik.toml</span>
kubectl delete configmap traefik-conf -n kube-system
kubectl create configmap traefik-conf --from-file<span class="o">=</span>traefik.toml -n kube-system
kubectl delete -f traefik.yml
kubectl create -f traefik.yml
</code></pre></div>

<h2 id="kubernetes-dashboard-for-local">Kubernetes Dashboard for local</h2>
<h3 id="create-service-account">Create service account</h3>
<div class="highlight"><pre><span></span><code><span class="c1">#admin-user.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">admin-user</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
</code></pre></div>

<h3 id="create-role-binding">Create role binding</h3>
<div class="highlight"><pre><span></span><code><span class="c1">#admin-user-role-binding.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">admin-user</span>
<span class="nt">roleRef</span><span class="p">:</span>
  <span class="nt">apiGroup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
  <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cluster-admin</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">admin-user</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
</code></pre></div>

<h3 id="apply-yaml">Apply yaml</h3>
<div class="highlight"><pre><span></span><code><span class="c1">#Apply service account</span>
kubectl create -f admin-user.yaml

<span class="c1">#Apply role binding</span>
kubectl create -f admin-user-role-binding.yaml
</code></pre></div>

<h3 id="retrieve-login-token">Retrieve login token</h3>
<div class="highlight"><pre><span></span><code>kubectl -n kube-system describe secret <span class="k">$(</span>kubectl -n kube-system get secret <span class="p">|</span> grep admin-user <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>
</code></pre></div>

<h3 id="install-dashboard">Install dashboard</h3>
<div class="highlight"><pre><span></span><code>kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/master/aio/deploy/recommended/kubernetes-dashboard.yaml

<span class="c1">#Create proxy to allow only localhost navigating</span>
kubectl proxy
kubectl proxy --address<span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span> --accept-hosts<span class="o">=</span><span class="s1">&#39;^*$&#39;</span>
</code></pre></div>

<h2 id="kubernetes-dashboard-for-public">Kubernetes Dashboard for public</h2>
<h3 id="create-certificates">Create certificates</h3>
<div class="highlight"><pre><span></span><code>mkdir <span class="nv">$HOME</span>/certs
<span class="nb">cd</span> <span class="nv">$HOME</span>/certs
openssl genrsa -out dashboard.key <span class="m">2048</span>
openssl rsa -in dashboard.key -out dashboard.key
openssl req -sha256 -new -key dashboard.key -out dashboard.csr -subj <span class="s1">&#39;/CN=localhost&#39;</span>
openssl x509 -req -sha256 -days <span class="m">365</span> -in dashboard.csr -signkey dashboard.key -out dashboard.crt
kubectl -n kube-system create secret generic kubernetes-dashboard-certs --from-file<span class="o">=</span><span class="nv">$HOME</span>/certs
</code></pre></div>

<h3 id="install-dashboard_1">Install dashboard</h3>
<div class="highlight"><pre><span></span><code>kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/master/src/deploy/recommended/kubernetes-dashboard.yaml

<span class="c1">#Wait and check if the replica set is fulfilled</span>
kubectl -n kube-system get rs
</code></pre></div>

<h3 id="create-psp">Create PSP</h3>
<div class="highlight"><pre><span></span><code>kubectl -n kube-system create -f - <span class="s">&lt;&lt;EOF</span>
<span class="s">apiVersion: extensions/v1beta1</span>
<span class="s">kind: PodSecurityPolicy</span>
<span class="s">metadata:</span>
<span class="s">  name: dashboard</span>
<span class="s">spec:</span>
<span class="s">  privileged: false</span>
<span class="s">  seLinux:</span>
<span class="s">    rule: RunAsAny</span>
<span class="s">  supplementalGroups:</span>
<span class="s">    rule: RunAsAny</span>
<span class="s">  runAsUser:</span>
<span class="s">    rule: RunAsAny</span>
<span class="s">  fsGroup:</span>
<span class="s">    rule: RunAsAny</span>
<span class="s">  volumes:</span>
<span class="s">  - &#39;*&#39;</span>
<span class="s">EOF</span>
</code></pre></div>

<h3 id="create-role">Create role</h3>
<div class="highlight"><pre><span></span><code>kubectl -n kube-system create role psp:dashboard --verb<span class="o">=</span>use --resource<span class="o">=</span>podsecuritypolicy --resource-name<span class="o">=</span>dashboard
</code></pre></div>

<h3 id="bind-role-and-account">Bind role and account</h3>
<div class="highlight"><pre><span></span><code>kubectl -n kube-system create rolebinding kubernetes-dashboard-policy --role<span class="o">=</span>psp:dashboard --serviceaccount<span class="o">=</span>kube-system:kubernetes-dashboard
kubectl --as<span class="o">=</span>system:serviceaccount:kube-system:kubernetes-dashboard -n kube-system auth can-i use podsecuritypolicy/dashboard
</code></pre></div>

<h3 id="expose-service-on-nodeport">Expose service on NodePort</h3>
<div class="highlight"><pre><span></span><code><span class="c1">#Edit the kubernetes-dashboard service and change the following options:</span>
<span class="c1">#   spec.type from ClusterIP to NodePort</span>
*   spec.ports<span class="o">[</span><span class="m">0</span><span class="o">]</span>.nodePort from <span class="m">32641</span> to whatever port you want it to be exposed on
kubectl -n kube-system edit service kubernetes-dashboard
kubectl -n kube-system get services
</code></pre></div>

<h3 id="navigate-the-dashboard-publicly">Navigate the dashboard publicly</h3>
<div class="highlight"><pre><span></span><code><span class="c1">#Configure the dns in the domain provider console</span>
https://<span class="o">[</span>domain<span class="o">]</span>:30104/
</code></pre></div>

<h3 id="expose-traefik-ingress">Expose Traefik ingress</h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dashboard-ingress</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">rules</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">host</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">domain</span><span class="p p-Indicator">]</span>
      <span class="nt">http</span><span class="p">:</span>
        <span class="nt">paths</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
            <span class="nt">backend</span><span class="p">:</span>
              <span class="nt">serviceName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
              <span class="nt">servicePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">443</span>
</code></pre></div>

<h2 id="scenarios">Scenarios</h2>
<h3 id="run-a-busybox-container">Run a busybox container</h3>
<div class="highlight"><pre><span></span><code>kubectl run -i --tty --image busybox <span class="nb">test</span> --restart<span class="o">=</span>Never --rm /bin/sh
</code></pre></div>

<h3 id="user-docker-hub-secret-in-pods">User docker hub secret in pods</h3>
<div class="highlight"><pre><span></span><code><span class="c1">#docker login and get the file: ~/.docker/config.json</span>
docker login
kubectl create secret generic docker-hub --from-file<span class="o">=</span>.dockerconfigjson<span class="o">=</span>~/.docker/config.json --type<span class="o">=</span>kubernetes.io/dockerconfigjson --namespace<span class="o">=</span><span class="nb">test</span>

<span class="c1">#Create a Pod that uses the Secret like bellow</span>
kind: Deployment
apiVersion: extensions/v1beta1
metadata:
  name: test-server
  namespace: <span class="nb">test</span>
spec:
  replicas: <span class="m">2</span>
  template:
    metadata:
      labels:
        app: test-server
    spec:
      containers:
        - name: test-server
          image: demo/test-server
      imagePullSecrets:
        - name: docker-hub
</code></pre></div>

<h3 id="default-storage-class">Default storage class</h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">StorageClass</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">standard</span>
<span class="nt">provisioner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes.io/aws-ebs</span>
<span class="nt">parameters</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gp2</span>
<span class="nt">reclaimPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Retain</span>
<span class="nt">mountOptions</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">debug</span>
<span class="nt">volumeBindingMode</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Immediate</span>
</code></pre></div>

<h3 id="create-mongodb-with-two-db-auth-settings">Create MongoDB with two DB auth settings</h3>
<div class="highlight"><pre><span></span><code><span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dev-mongodb</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">replicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">metadata</span><span class="p">:</span>
      <span class="nt">labels</span><span class="p">:</span>
        <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dev-mongodb</span>
    <span class="nt">spec</span><span class="p">:</span>
      <span class="nt">hostname</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mongodb</span>
      <span class="nt">containers</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dev-mongodb</span>
          <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hustakin/mongo-auth2:latest</span>
          <span class="nt">env</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MONGODB_ADMIN_USER</span>
              <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">admin</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MONGODB_ADMIN_PASS</span>
              <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">111</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MONGODB_APP1_DATABASE</span>
              <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">db1</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MONGODB_APP1_USER</span>
              <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">user1</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MONGODB_APP1_PASS</span>
              <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pass1</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MONGODB_APP2_DATABASE</span>
              <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">db2</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MONGODB_APP2_USER</span>
              <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">user2</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MONGODB_APP2_PASS</span>
              <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pass2</span>
          <span class="nt">ports</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">containerPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">27017</span>
              <span class="nt">protocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
              <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">db</span>
          <span class="nt">volumeMounts</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">mountPath</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/data/db</span>
              <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dev-mongo-persistent-storage</span>
          <span class="nt">livenessProbe</span><span class="p">:</span>
            <span class="nt">exec</span><span class="p">:</span>
              <span class="nt">command</span><span class="p">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mongo</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--eval</span>
                <span class="p p-Indicator">-</span> <span class="s">&quot;db.adminCommand(&#39;ping&#39;)&quot;</span>
            <span class="nt">failureThreshold</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
            <span class="nt">periodSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
            <span class="nt">successThreshold</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
            <span class="nt">timeoutSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
          <span class="nt">readinessProbe</span><span class="p">:</span>
            <span class="nt">exec</span><span class="p">:</span>
              <span class="nt">command</span><span class="p">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mongo</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--eval</span>
                <span class="p p-Indicator">-</span> <span class="s">&quot;db.adminCommand(&#39;ping&#39;)&quot;</span>
            <span class="nt">failureThreshold</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
            <span class="nt">periodSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
            <span class="nt">successThreshold</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
            <span class="nt">timeoutSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">imagePullSecrets</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">docker-hub</span>
      <span class="nt">volumes</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dev-mongo-persistent-storage</span>
          <span class="nt">persistentVolumeClaim</span><span class="p">:</span>
            <span class="nt">claimName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dev-local-data-pvc</span>
<span class="nn">---</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mongodb</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mongodb</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test</span>
  <span class="nt">annotations</span><span class="p">:</span>
    <span class="nt">traefik.ingress.kubernetes.io/affinity</span><span class="p">:</span> <span class="s">&quot;true&quot;</span>
    <span class="nt">traefik.ingress.kubernetes.io/session-cookie-name</span><span class="p">:</span> <span class="s">&quot;sticky&quot;</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
  <span class="nt">ports</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">protocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
      <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">27017</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">db</span>
  <span class="nt">selector</span><span class="p">:</span>
    <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dev-mongodb</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dev-local-data-pv</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">capacity</span><span class="p">:</span>
    <span class="nt">storage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">50Gi</span>
  <span class="nt">accessModes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
  <span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Retain</span>
  <span class="nt">storageClassName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">local-storage</span>
  <span class="nt">local</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/mnt/data</span>
  <span class="nt">nodeAffinity</span><span class="p">:</span>
    <span class="nt">required</span><span class="p">:</span>
      <span class="nt">nodeSelectorTerms</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">matchExpressions</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">node</span>
              <span class="nt">operator</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">In</span>
              <span class="nt">values</span><span class="p">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">db</span>
<span class="nn">---</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dev-local-data-pvc</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">accessModes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
  <span class="nt">storageClassName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">local-storage</span>
  <span class="nt">resources</span><span class="p">:</span>
    <span class="nt">requests</span><span class="p">:</span>
      <span class="nt">storage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">50Gi</span>
</code></pre></div>

<h2 id="useful-commands">Useful commands</h2>
<table>
<thead>
<tr>
<th>Scenarios</th>
<th>Commands</th>
</tr>
</thead>
<tbody>
<tr>
<td>Create or update</td>
<td>1. <code>kubectl create -f pod.yml</code> <br/>2. <code>kubectl apply -f pod.yml</code></td>
</tr>
<tr>
<td>Sort top pods in all namespace</td>
<td><code>kubectl top pod -A &amp;#124; sort -rnk 4</code></td>
</tr>
<tr>
<td>Add a label to the specific node</td>
<td><code>kubectl label nodes [node-name] [label]=[value]</code></td>
</tr>
<tr>
<td>List remaining resources in a namespace</td>
<td><code>kubectl api-resources --verbs=list --namespaced -o name &amp;#124; xargs -n 1 kubectl get --show-kind --ignore-not-found -n monitoring</code></td>
</tr>
<tr>
<td>Delete namespace forcely</td>
<td><code>kubectl delete ns heptio-sonobuoy --grace-period=0 --force</code></td>
</tr>
<tr>
<td>Copy the file in a pod to local</td>
<td><code>kubectl cp [pod-name]:/heap_dump.hprof heap_dump.hprof -n test</code></td>
</tr>
<tr>
<td>Check the k8s logs</td>
<td><code>journalctl -f -u kubelet</code></td>
</tr>
<tr>
<td>Delete all evicted pods from all namespaces</td>
<td><code>kubectl get pods --all-namespaces &amp;#124; grep Evicted &amp;#124; awk '{print $2 " --namespace=" $1}' &amp;#124; xargs kubectl delete pod</code></td>
</tr>
<tr>
<td>Delete all containers in ImagePullBackOff state from all namespaces</td>
<td><code>kubectl get pods --all-namespaces &amp;#124; grep 'ImagePullBackOff' &amp;#124; awk '{print $2 " --namespace=" $1}' &amp;#124; xargs kubectl delete pod</code></td>
</tr>
<tr>
<td>Delete all containers in ImagePullBackOff or ErrImagePull or Evicted state from all namespaces</td>
<td><code>kubectl get pods --all-namespaces &amp;#124; grep -E 'ImagePullBackOff&amp;#124;ErrImagePull&amp;#124;Evicted' &amp;#124; awk '{print $2 " --namespace=" $1}' &amp;#124; xargs kubectl delete pod</code></td>
</tr>
</tbody>
</table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../important-docker-commands/" title="Important Docker commands" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Important Docker commands
              </div>
            </div>
          </a>
        
        
          <a href="../amazon-ec2-101/" title="Amazon EC2 101" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Amazon EC2 101
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 Frankie Fan
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/hustakin" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://linkedin.com/in/hustakin" target="_blank" rel="noopener" title="linkedin.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://twitter.com/hustakin" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://instagram.com/hustakin" target="_blank" rel="noopener" title="instagram.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.77e55a48.min.js"></script>
      <script src="../../assets/javascripts/bundle.aa3f9871.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>