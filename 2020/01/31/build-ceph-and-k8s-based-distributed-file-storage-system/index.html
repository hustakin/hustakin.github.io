<!DOCTYPE html>





<html class="theme-next gemini use-motion" lang="en">
<head>
  <meta charset="UTF-8">
<meta name="generator" content="Hexo 3.9.0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.3.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    save_scroll: false,
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    }
  };
</script>

  <meta name="description" content="In this article, we are going to build a Ceph and Kubernetes based distributed file storage system and integrate into our java platform.">
<meta name="keywords" content="Kubernetes,Ceph">
<meta property="og:type" content="article">
<meta property="og:title" content="Build Ceph and Kubernetes based distributed file storage system">
<meta property="og:url" content="http://hustakin.github.io/2020/01/31/build-ceph-and-k8s-based-distributed-file-storage-system/index.html">
<meta property="og:site_name" content="Frankie Fan">
<meta property="og:description" content="In this article, we are going to build a Ceph and Kubernetes based distributed file storage system and integrate into our java platform.">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2020-02-17T04:01:31.635Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Build Ceph and Kubernetes based distributed file storage system">
<meta name="twitter:description" content="In this article, we are going to build a Ceph and Kubernetes based distributed file storage system and integrate into our java platform.">
  <link rel="canonical" href="http://hustakin.github.io/2020/01/31/build-ceph-and-k8s-based-distributed-file-storage-system/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Build Ceph and Kubernetes based distributed file storage system | Frankie Fan</title>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-146443611-1"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-146443611-1');
    }
  </script>








  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  <div class="container sidebar-position-left">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Frankie Fan</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags<span class="badge">23</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories<span class="badge">4</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives<span class="badge">17</span></a>

  </li>
  </ul>

</nav>
</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content page-post-detail">
            

  <div id="posts" class="posts-expand">
    

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://hustakin.github.io/2020/01/31/build-ceph-and-k8s-based-distributed-file-storage-system/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Frankie Fan">
      <meta itemprop="description" content="Live for die and let it go.">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Frankie Fan">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">Build Ceph and Kubernetes based distributed file storage system

            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2020-01-31 12:46:01" itemprop="dateCreated datePublished" datetime="2020-01-31T12:46:01+10:00">2020-01-31</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-02-17 14:01:31" itemprop="dateModified" datetime="2020-02-17T14:01:31+10:00">2020-02-17</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Best-Practice/" itemprop="url" rel="index"><span itemprop="name">Best Practice</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/DevOps/" itemprop="url" rel="index"><span itemprop="name">DevOps</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <html><head></head><body><p>In this article, we are going to build a Ceph and Kubernetes based distributed file storage system and integrate into our java platform.</p>
<a id="more"></a>

<h2 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h2><h3 id="Download-rook"><a href="#Download-rook" class="headerlink" title="Download rook"></a>Download rook</h3><p>Download the rook ceph GitHub code.</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> --single-branch --branch release-1.2 https://github.com/rook/rook.git</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Copy-yaml"><a href="#Copy-yaml" class="headerlink" title="Copy yaml"></a>Copy yaml</h3><p>Copy the common.yaml, operator.yaml and toolbox.yaml files from ./rook/cluster/examples/kubernetes/ceph/.</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp ../rook/cluster/examples/kubernetes/ceph/common.yaml ../rook/cluster/examples/kubernetes/ceph/operator.yaml ../rook/cluster/examples/kubernetes/ceph/toolbox.yaml .</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Create-rook-containers"><a href="#Create-rook-containers" class="headerlink" title="Create rook containers"></a>Create rook containers</h3><p>Create the rook ceph containers, and wait the operator to be running status.</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f common.yaml</span><br><span class="line">kubectl apply -f operator.yaml</span><br><span class="line">kubectl get pod -n rook-ceph</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Create-volumes"><a href="#Create-volumes" class="headerlink" title="Create volumes"></a>Create volumes</h3><p>Create 3 20G volumes and attach to 3 linux instances. Format the disks. Mkdir /mnt/ceph-storage and mount them all.</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo fdisk -l</span><br><span class="line">sudo mkfs.ext4 /dev/vdc</span><br><span class="line">sudo mount /dev/vdb /mnt/ceph-storage -t auto</span><br><span class="line">df -h</span><br></pre></td></tr></tbody></table></figure>

<pre><code>Filesystem      Size  Used Avail Use% Mounted on
/dev/vda1        30G   19G   11G  65% /
devtmpfs        2.9G     0  2.9G   0% /dev
tmpfs           2.9G   12K  2.9G   1% /dev/shm
tmpfs           2.9G  298M  2.6G  11% /run
tmpfs           2.9G     0  2.9G   0% /sys/fs/cgroup
tmpfs           581M     0  581M   0% /run/user/1000
/dev/vdb         20G   45M   19G   1% /mnt/ceph-storage</code></pre><h3 id="Create-Ceph-cluster"><a href="#Create-Ceph-cluster" class="headerlink" title="Create Ceph cluster"></a>Create Ceph cluster</h3><p>Create cluster by the cluster.yaml. Notice the selected nodes have the disks attached. Each node��s ��name�� field should match their ��kubernetes.io/hostname�� label. Notice the dashboard should be disabled first.</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">ceph.rook.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CephCluster</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">rook-ceph</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">rook-ceph</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  dataDirHostPath:</span> <span class="string">/var/lib/rook</span></span><br><span class="line"><span class="attr">  mon:</span></span><br><span class="line"><span class="attr">    count:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">  cephVersion:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">ceph/ceph:v14.2.4-20190917</span></span><br><span class="line"><span class="attr">    allowUnsupported:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  dashboard:</span></span><br><span class="line"><span class="attr">    enabled:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  network:</span></span><br><span class="line"><span class="attr">    hostNetwork:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  storage:</span></span><br><span class="line"><span class="attr">    useAllNodes:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    useAllDevices:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    config:</span></span><br><span class="line"><span class="attr">      metadataDevice:</span></span><br><span class="line"><span class="attr">      databaseSizeMB:</span> <span class="string">"1024"</span> <span class="comment"># this value can be removed for environments with normal sized disks (100 GB or larger)</span></span><br><span class="line"><span class="attr">      journalSizeMB:</span> <span class="string">"1024"</span>  <span class="comment"># this value can be removed for environments with normal sized disks (20 GB or larger)</span></span><br><span class="line"><span class="attr">    nodes:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">"slave.novalocal"</span></span><br><span class="line"><span class="attr">        directories:</span>         <span class="comment"># specific directories to use for storage can be specified for each node</span></span><br><span class="line"><span class="attr">          - path:</span> <span class="string">"/mnt/ceph-storage"</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">"static.novalocal"</span></span><br><span class="line"><span class="attr">        directories:</span>         <span class="comment"># specific directories to use for storage can be specified for each node</span></span><br><span class="line"><span class="attr">          - path:</span> <span class="string">"/mnt/ceph-storage"</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">"db.novalocal"</span></span><br><span class="line"><span class="attr">        directories:</span>         <span class="comment"># specific directories to use for storage can be specified for each node</span></span><br><span class="line"><span class="attr">          - path:</span> <span class="string">"/mnt/ceph-storage"</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f cluster.yaml</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Re-create-operator-and-check-osd"><a href="#Re-create-operator-and-check-osd" class="headerlink" title="Re-create operator and check osd"></a>Re-create operator and check osd</h3><p>If error happens, remember to delete the folder dataDirHostPath on all nodes and delete the operator, then try again to create the cluster. Attach the operator pod to see the logs. When 3 mon and 3 osd pods are running it means the cluster is successfully created.</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo rm -rf /var/lib/rook</span><br><span class="line">kubectl delete -f operator.yaml</span><br><span class="line">kubectl logs -f rook-ceph-operator-6b79d99f5c-9564s -n rook-ceph</span><br><span class="line">kubectl get pod -n rook-ceph</span><br></pre></td></tr></tbody></table></figure>

<pre><code>NAME                                                        READY   STATUS      RESTARTS   AGE
csi-cephfsplugin-265lj                                      3/3     Running     0          37m
csi-cephfsplugin-2b47v                                      3/3     Running     0          37m
csi-cephfsplugin-2dw6z                                      3/3     Running     0          37m
csi-cephfsplugin-2xgns                                      3/3     Running     0          37m
csi-cephfsplugin-54hd5                                      3/3     Running     0          37m
csi-cephfsplugin-9rgr8                                      3/3     Running     0          37m
csi-cephfsplugin-provisioner-5d999b68d6-8vc2k               4/4     Running     0          37m
csi-cephfsplugin-provisioner-5d999b68d6-xjg4z               4/4     Running     0          37m
csi-cephfsplugin-sp289                                      3/3     Running     0          37m
csi-rbdplugin-7gk9s                                         3/3     Running     0          37m
csi-rbdplugin-9sbwh                                         3/3     Running     0          37m
csi-rbdplugin-jwvxx                                         3/3     Running     0          37m
csi-rbdplugin-n9tcd                                         3/3     Running     0          37m
csi-rbdplugin-provisioner-69b7d7887-4l9l9                   5/5     Running     0          37m
csi-rbdplugin-provisioner-69b7d7887-g48rb                   5/5     Running     0          37m
csi-rbdplugin-q9q5b                                         3/3     Running     0          37m
csi-rbdplugin-snhqj                                         3/3     Running     0          37m
csi-rbdplugin-v6jb8                                         3/3     Running     0          37m
rook-ceph-crashcollector-db.novalocal-fd7dcc457-qd7tx       1/1     Running     0          11m
rook-ceph-crashcollector-deamon.novalocal-7789457f5-v6vnc   1/1     Running     0          11m
rook-ceph-crashcollector-slave.novalocal-5d698c7d7b-hgbnw   1/1     Running     0          9m59s
rook-ceph-crashcollector-static.novalocal-58f769ccc-lsf5b   1/1     Running     0          9m54s
rook-ceph-crashcollector-test.novalocal-6fdc8dbc4f-ksk75    1/1     Running     0          10m
rook-ceph-mgr-a-7898b59757-84tbd                            1/1     Running     0          10m
rook-ceph-mon-a-7676f96769-5mhc6                            1/1     Running     0          12m
rook-ceph-mon-b-79c9c9b59d-g82sc                            1/1     Running     0          11m
rook-ceph-mon-c-7b679d7497-x2hjg                            1/1     Running     0          11m
rook-ceph-operator-6b79d99f5c-9564s                         1/1     Running     0          14m
rook-ceph-osd-0-5b59576bb4-rgsx8                            1/1     Running     0          9m57s
rook-ceph-osd-1-74ff9d79c6-hpkc2                            1/1     Running     0          9m55s
rook-ceph-osd-2-57748ff6bf-vf8jl                            1/1     Running     0          9m59s
rook-ceph-osd-prepare-db.novalocal-jf84v                    0/1     Completed   0          10m
rook-ceph-osd-prepare-slave.novalocal-j457l                 0/1     Completed   0          10m
rook-ceph-osd-prepare-static.novalocal-jt4vj                0/1     Completed   0          10m
rook-discover-hwffd                                         1/1     Running     0          13m
rook-discover-jh8j5                                         1/1     Running     0          13m
rook-discover-mcdjn                                         1/1     Running     0          13m
rook-discover-mmzcb                                         1/1     Running     0          13m
rook-discover-mppgh                                         1/1     Running     0          13m
rook-discover-tz5gm                                         1/1     Running     0          13m
rook-discover-vj7tg                                         1/1     Running     0          13m</code></pre><h3 id="Create-toolbox-and-test"><a href="#Create-toolbox-and-test" class="headerlink" title="Create toolbox and test"></a>Create toolbox and test</h3><p>Create toolbox pods by toolbox.yaml, and we can attach the pod then test the ceph status.</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f toolbox.yaml</span><br><span class="line">kubectl -n rook-ceph <span class="built_in">exec</span> -it $(kubectl -n rook-ceph get pod -l <span class="string">"app=rook-ceph-tools"</span> -o jsonpath=<span class="string">'{.items[0].metadata.name}'</span>) bash</span><br><span class="line">ceph status</span><br><span class="line">ceph osd status</span><br><span class="line">ceph df</span><br><span class="line">rados df</span><br></pre></td></tr></tbody></table></figure>

<pre><code>[root@rook-ceph-tools-787dc6b944-spsjh /]# ceph status
  cluster:
    id:     2095eaca-93b3-4365-a5c8-9b05269821a9
    health: HEALTH_OK

  services:
    mon: 3 daemons, quorum a,b,c (age 26m)
    mgr: a(active, since 26m)
    osd: 3 osds: 3 up (since 25m), 3 in (since 25m)

  data:
    pools:   0 pools, 0 pgs
    objects: 0 objects, 0 B
    usage:   6.4 GiB used, 52 GiB / 59 GiB avail
    pgs:</code></pre><h3 id="Enable-dashboard"><a href="#Enable-dashboard" class="headerlink" title="Enable dashboard"></a>Enable dashboard</h3><p>Modify the cluster.yaml to enable dashboard and apply to create the dashboard service.</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim cluster.yaml</span><br><span class="line">kubectl apply -f cluster.yaml</span><br><span class="line">kubectl get svc -n rook-ceph |grep mgr-dashboard</span><br></pre></td></tr></tbody></table></figure>

<pre><code>rook-ceph-mgr-dashboard    ClusterIP   10.36.19.173     <none>        7000/TCP            66s</code></pre><h3 id="Create-dashboard-ingress"><a href="#Create-dashboard-ingress" class="headerlink" title="Create dashboard ingress"></a>Create dashboard ingress</h3><p>Now the dashboard service is ClusterIP mode which means we can only visit it in the cluster. Create dashboard Traefik yaml file dashboard-ingress.yaml to visit publicly.</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">ceph-dashboard-ingress</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">rook-ceph</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">    - host:</span> <span class="string">dashboard.*.*</span></span><br><span class="line"><span class="attr">      http:</span></span><br><span class="line"><span class="attr">        paths:</span></span><br><span class="line"><span class="attr">          - path:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">            backend:</span></span><br><span class="line"><span class="attr">              serviceName:</span> <span class="string">rook-ceph-mgr-dashboard</span></span><br><span class="line"><span class="attr">              servicePort:</span> <span class="number">7000</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f dashboard-ingress.yaml</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Inspect-dashboard-password"><a href="#Inspect-dashboard-password" class="headerlink" title="Inspect dashboard password"></a>Inspect dashboard password</h3><p>Inspect the dashboard secret. The username is admin.</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n rook-ceph get secret rook-ceph-dashboard-password -o jsonpath=<span class="string">"{['data']['password']}"</span> | base64 --decode && <span class="built_in">echo</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="Create-object-gateway"><a href="#Create-object-gateway" class="headerlink" title="Create object gateway"></a>Create object gateway</h3><p>Create object gateway by the object.yaml. </p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">ceph.rook.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CephObjectStore</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">my-store</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">rook-ceph</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  metadataPool:</span></span><br><span class="line"><span class="attr">    failureDomain:</span> <span class="string">host</span></span><br><span class="line"><span class="attr">    replicated:</span></span><br><span class="line"><span class="attr">      size:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">  dataPool:</span></span><br><span class="line"><span class="attr">    failureDomain:</span> <span class="string">host</span></span><br><span class="line"><span class="attr">    replicated:</span></span><br><span class="line"><span class="attr">      size:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">  preservePoolsOnDelete:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  gateway:</span></span><br><span class="line"><span class="attr">    type:</span> <span class="string">s3</span></span><br><span class="line"><span class="attr">    sslCertificateRef:</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">    securePort:</span></span><br><span class="line"><span class="attr">    instances:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">    placement:</span></span><br><span class="line"><span class="attr">    annotations:</span></span><br><span class="line"><span class="attr">    resources:</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f object.yaml</span><br><span class="line">kubectl -n rook-ceph get pod -l app=rook-ceph-rgw</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Create-radosgw-user"><a href="#Create-radosgw-user" class="headerlink" title="Create radosgw user"></a>Create radosgw user</h3><p>Create a radosgw user in the toolbox.</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n rook-ceph <span class="built_in">exec</span> -it $(kubectl -n rook-ceph get pod -l <span class="string">"app=rook-ceph-tools"</span> -o jsonpath=<span class="string">'{.items[0].metadata.name}'</span>) bash</span><br><span class="line">radosgw-admin user create --uid=myuser --display-name=<span class="built_in">test</span>-user --system</span><br><span class="line">ceph dashboard <span class="built_in">set</span>-rgw-api-user-id myuser</span><br><span class="line">ceph dashboard <span class="built_in">set</span>-rgw-api-access-key 32APIT3RA29JCO6OCR8P</span><br><span class="line">ceph dashboard <span class="built_in">set</span>-rgw-api-secret-key 2ioxTu6iBFkYP8UKiycS90A2DFwRBklSI8Bp3iPQ</span><br></pre></td></tr></tbody></table></figure>

<pre><code>{
    "user_id": "myuser",
    "display_name": "test-user",
    "email": "",
    "suspended": 0,
    "max_buckets": 1000,
    "subusers": [],
    "keys": [
        {
            "user": "myuser",
            "access_key": "32APIT3RA29JCO6OCR8P",
            "secret_key": "2ioxTu6iBFkYP8UKiycS90A2DFwRBklSI8Bp3iPQ"
        }
    ],
    "swift_keys": [],
    "caps": [],
    "op_mask": "read, write, delete",
    "system": "true",
    "default_placement": "",
    "default_storage_class": "",
    "placement_tags": [],
    "bucket_quota": {
        "enabled": false,
        "check_on_raw": false,
        "max_size": -1,
        "max_size_kb": 0,
        "max_objects": -1
    },
    "user_quota": {
        "enabled": false,
        "check_on_raw": false,
        "max_size": -1,
        "max_size_kb": 0,
        "max_objects": -1
    },
    "temp_url_keys": [],
    "type": "rgw",
    "mfa_ids": []
}</code></pre><h3 id="Test-S3-service-in-cluster"><a href="#Test-S3-service-in-cluster" class="headerlink" title="Test S3 service in cluster"></a>Test S3 service in cluster</h3><p>Connect the toolbox and test the object storage inside the cluster.</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n rook-ceph <span class="built_in">exec</span> -it $(kubectl -n rook-ceph get pod -l <span class="string">"app=rook-ceph-tools"</span> -o jsonpath=<span class="string">'{.items[0].metadata.name}'</span>) bash</span><br><span class="line">yum --assumeyes install s3cmd</span><br><span class="line"><span class="comment"># The content is as bellow. The host is where the rgw service is listening. Run kubectl -n rook-ceph get svc rook-ceph-rgw-my-store, then combine the clusterIP and the port.</span></span><br><span class="line">vi .s3cfg</span><br><span class="line">s3cmd mb s3://<span class="built_in">test</span>-bucket</span><br><span class="line">s3cmd ls</span><br></pre></td></tr></tbody></table></figure>

<pre><code>[default]
access_key = Y14QX4KYOBCdvwMU6E5R
secret_key = AbeWMQPzpGhZPCMOq9IEkZSxLIgtooQsdvx4Cb4v
host_base = 10.100.191.33
host_bucket = 10.100.191.33/%(bucket)
use_https = False</code></pre><h3 id="Create-S3-external-service"><a href="#Create-S3-external-service" class="headerlink" title="Create S3 external service"></a>Create S3 external service</h3><p>Create the external service for the object store by using NodePort in the rgw-external.yaml. Cannot use Traefik here because it automatically redirect http to https which is not allowed in s3cmd.</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">rook-ceph-rgw-my-store-external</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">rook-ceph</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">rook-ceph-rgw</span></span><br><span class="line"><span class="attr">    rook_cluster:</span> <span class="string">rook-ceph</span></span><br><span class="line"><span class="attr">    rook_object_store:</span> <span class="string">my-store</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">rgw</span></span><br><span class="line"><span class="attr">      port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">      protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">      targetPort:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">rook-ceph-rgw</span></span><br><span class="line"><span class="attr">    rook_cluster:</span> <span class="string">rook-ceph</span></span><br><span class="line"><span class="attr">    rook_object_store:</span> <span class="string">my-store</span></span><br><span class="line"><span class="attr">  sessionAffinity:</span> <span class="string">None</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">NodePort</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f rgw-external.yaml</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Test-S3-service-outside-cluster"><a href="#Test-S3-service-outside-cluster" class="headerlink" title="Test S3 service outside cluster"></a>Test S3 service outside cluster</h3><p>Test the object storage outside the cluster. Remember to replace the credentials and endpoint.</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># For windows we can download the s3cmd code from github and then "python s3cmd --configure" to save the configuration and then edit it with the below content.</span></span><br><span class="line"><span class="comment"># Run kubectl -n rook-ceph get service rook-ceph-rgw-my-store-external, then combine the node public ip and the external port as the host bellow.</span></span><br><span class="line"><span class="comment"># Run python s3cmd ls to test on Windows</span></span><br></pre></td></tr></tbody></table></figure>

<pre><code>[default]
access_key = Y14QX4KYOBC83Vsev6E5R
secret_key = AbeWMQPzpGhZPCMOq9IEkZSLIsetooQcUfx4Cb4v
host_base = *:*
host_bucket = *:*/%(bucket)
use_https = False</code></pre><h3 id="Test-S3-service-in-Java"><a href="#Test-S3-service-in-Java" class="headerlink" title="Test S3 service in Java"></a>Test S3 service in Java</h3><p>Test the object storage with java code. Remember to replace the credentials and endpoint. The code works for both Amazon S3 and Ceph S3 except the conn part.</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//The conn here is for Ceph S3</span></span><br><span class="line">AWSCredentials credentials = <span class="keyword">new</span> BasicAWSCredentials(<span class="string">"***"</span>, <span class="string">"***"</span>);</span><br><span class="line">ClientConfiguration clientConfig = <span class="keyword">new</span> ClientConfiguration();</span><br><span class="line">clientConfig.setProtocol(Protocol.HTTP);</span><br><span class="line">AmazonS3 conn = AmazonS3Client.builder()</span><br><span class="line">        .withCredentials(<span class="keyword">new</span> AWSStaticCredentialsProvider(credentials))</span><br><span class="line">        .withClientConfiguration(clientConfig) <span class="comment">//Important for Ceph</span></span><br><span class="line">        .withEndpointConfiguration(<span class="keyword">new</span> AwsClientBuilder.EndpointConfiguration(<span class="string">"*:*"</span>, <span class="keyword">null</span>)) <span class="comment">//Important for Ceph</span></span><br><span class="line">        .enablePathStyleAccess() <span class="comment">//Important for Ceph</span></span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line"><span class="comment">//The conn here is for Amazon S3</span></span><br><span class="line"><span class="comment">//AWSCredentials credentials = new BasicAWSCredentials("***", "***");</span></span><br><span class="line"><span class="comment">//AmazonS3 conn = AmazonS3Client.builder()</span></span><br><span class="line"><span class="comment">//        .withRegion("ap-northeast-1") //Important for Amazon</span></span><br><span class="line"><span class="comment">//        .withCredentials(new AWSStaticCredentialsProvider(credentials))</span></span><br><span class="line"><span class="comment">//        .build();</span></span><br><span class="line"></span><br><span class="line">File file = <span class="keyword">new</span> File(<span class="string">"C:\\Users\\fanf\\Pictures\\test.jpg"</span>);</span><br><span class="line">FileInputStream bais = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">ObjectMetadata metadata = <span class="keyword">new</span> ObjectMetadata();</span><br><span class="line">metadata.setContentLength(file.length());</span><br><span class="line">metadata.setContentType(<span class="string">"image/jpg"</span>);</span><br><span class="line">conn.putObject(<span class="string">"test-bucket"</span>, <span class="string">"test.jpg"</span>, bais, metadata);</span><br><span class="line">conn.setObjectAcl(<span class="string">"test-bucket"</span>, <span class="string">"test.jpg"</span>, CannedAccessControlList.PublicRead);</span><br><span class="line"></span><br><span class="line">ListObjectsRequest listObjectsRequest =</span><br><span class="line">        <span class="keyword">new</span> ListObjectsRequest().withBucketName(<span class="string">"test-bucket"</span>).withDelimiter(<span class="string">"test-bucket/"</span>);</span><br><span class="line">ObjectListing objects2 = conn.listObjects(listObjectsRequest);</span><br><span class="line">Helper.println(objects2);</span><br><span class="line"></span><br><span class="line">conn.setBucketPolicy(<span class="string">"test-bucket"</span>, <span class="string">"public-read-write"</span>);</span><br><span class="line">Bucket bucket2 = conn.createBucket(<span class="string">"new-bucket"</span>);</span><br><span class="line">ByteArrayInputStream input = <span class="keyword">new</span> ByteArrayInputStream(<span class="string">"Hello World!"</span>.getBytes());</span><br><span class="line">conn.putObject(bucket2.getName(), <span class="string">"hello.txt"</span>, input, <span class="keyword">new</span> ObjectMetadata());</span><br><span class="line">conn.setObjectAcl(bucket2.getName(), <span class="string">"hello.txt"</span>, CannedAccessControlList.PublicRead);</span><br><span class="line"></span><br><span class="line">List<Bucket> buckets = conn.listBuckets();</span><br><span class="line"><span class="keyword">for</span> (Bucket bucket : buckets) {</span><br><span class="line">    Helper.println(bucket.getName() + <span class="string">"\t"</span> +</span><br><span class="line">            StringUtils.fromDate(bucket.getCreationDate()));</span><br><span class="line">    ObjectListing objects = conn.listObjects(bucket.getName());</span><br><span class="line">    <span class="keyword">do</span> {</span><br><span class="line">        <span class="keyword">for</span> (S3ObjectSummary objectSummary : objects.getObjectSummaries()) {</span><br><span class="line">            Helper.println(objectSummary.getKey() + <span class="string">"\t"</span> +</span><br><span class="line">                    objectSummary.getSize() + <span class="string">"\t"</span> +</span><br><span class="line">                    StringUtils.fromDate(objectSummary.getLastModified()));</span><br><span class="line">        }</span><br><span class="line">        objects = conn.listNextBatchOfObjects(objects);</span><br><span class="line">    } <span class="keyword">while</span> (objects.isTruncated());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

</body></html>
    </div>

    
    
    
        
      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/Kubernetes/" rel="tag"><i class="fa fa-tag"></i> Kubernetes</a>
            
              <a href="/tags/Ceph/" rel="tag"><i class="fa fa-tag"></i> Ceph</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2019/10/02/international-money-transfer-from-commanwealth-bank-to-china/" rel="next" title="International money transfer from CommonWealth bank to China">
                  <i class="fa fa-chevron-left"></i> International money transfer from CommonWealth bank to China
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/uploads/avatar.png"
      alt="Frankie Fan">
  <p class="site-author-name" itemprop="name">Frankie Fan</p>
  <div class="site-description motion-element" itemprop="description">Live for die and let it go.</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">17</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">tags</span>
        </a>
      </div>
    
  </nav>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
      
        
      
        <a href="https://github.com/hustakin" title="GitHub &rarr; https://github.com/hustakin" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a>
      </span>
    
      <span class="links-of-author-item">
      
      
      
        
      
        <a href="mailto:hustakin@gmail.com" title="E-Mail &rarr; mailto:hustakin@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
      </span>
    
      <span class="links-of-author-item">
      
      
      
        
      
        <a href="https://www.linkedin.com/in/hustakin/" title="LinkedIn &rarr; https://www.linkedin.com/in/hustakin/" rel="noopener" target="_blank"><i class="fa fa-fw fa-linkedin"></i></a>
      </span>
    
      <span class="links-of-author-item">
      
      
      
        
      
        <a href="https://twitter.com/hustakin" title="Twitter &rarr; https://twitter.com/hustakin" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i></a>
      </span>
    
      <span class="links-of-author-item">
      
      
      
        
      
        <a href="https://www.facebook.com/hustakin" title="FB Page &rarr; https://www.facebook.com/hustakin" rel="noopener" target="_blank"><i class="fa fa-fw fa-facebook"></i></a>
      </span>
    
  </div>



        </div>
      </div>
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Install"><span class="nav-number">1.</span> <span class="nav-text">Install</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Download-rook"><span class="nav-number">1.1.</span> <span class="nav-text">Download rook</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Copy-yaml"><span class="nav-number">1.2.</span> <span class="nav-text">Copy yaml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Create-rook-containers"><span class="nav-number">1.3.</span> <span class="nav-text">Create rook containers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Create-volumes"><span class="nav-number">1.4.</span> <span class="nav-text">Create volumes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Create-Ceph-cluster"><span class="nav-number">1.5.</span> <span class="nav-text">Create Ceph cluster</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Re-create-operator-and-check-osd"><span class="nav-number">1.6.</span> <span class="nav-text">Re-create operator and check osd</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Create-toolbox-and-test"><span class="nav-number">1.7.</span> <span class="nav-text">Create toolbox and test</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Enable-dashboard"><span class="nav-number">1.8.</span> <span class="nav-text">Enable dashboard</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Create-dashboard-ingress"><span class="nav-number">1.9.</span> <span class="nav-text">Create dashboard ingress</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Inspect-dashboard-password"><span class="nav-number">1.10.</span> <span class="nav-text">Inspect dashboard password</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Create-object-gateway"><span class="nav-number">1.11.</span> <span class="nav-text">Create object gateway</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Create-radosgw-user"><span class="nav-number">1.12.</span> <span class="nav-text">Create radosgw user</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Test-S3-service-in-cluster"><span class="nav-number">1.13.</span> <span class="nav-text">Test S3 service in cluster</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Create-S3-external-service"><span class="nav-number">1.14.</span> <span class="nav-text">Create S3 external service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Test-S3-service-outside-cluster"><span class="nav-number">1.15.</span> <span class="nav-text">Test S3 service outside cluster</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Test-S3-service-in-Java"><span class="nav-number">1.16.</span> <span class="nav-text">Test S3 service in Java</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Frankie Fan</span>
</div>


    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item-icon"><i class="fa fa-user"></i></span>
    <span class="site-uv" title="Total Visitors">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon"><i class="fa fa-eye"></i></span>
    <span class="site-pv" title="Total Views">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>


        








        
      </div>
    </footer>

    

  </div>

  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

<script src="/js/utils.js?v=7.3.0"></script>
  <script src="/js/motion.js?v=7.3.0"></script>


  <script src="/js/affix.js?v=7.3.0"></script>
  <script src="/js/schemes/pisces.js?v=7.3.0"></script>



<script src="/js/next-boot.js?v=7.3.0"></script>




  




























  

  

  


  
  <script src="/js/scrollspy.js?v=7.3.0"></script>
<script src="/js/post-details.js?v=7.3.0"></script>


</body>
</html>
