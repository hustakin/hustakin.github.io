
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://hustakin.github.io/bestpractice/setup-jenkins-pipeline-in-kubernetes/">
      
      
        <meta name="author" content="Frankie Fan">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.7">
    
    
      
        <title>Setup Jenkins Pipeline and Blue Ocean in Kubernetes - Frankie Fan's Memos</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.19753c6b.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.196e0c26.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-146443611-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview",document.location.pathname)})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="teal">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#install-jenkins-in-k8s" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://hustakin.github.io" title="Frankie Fan&#39;s Memos" class="md-header-nav__button md-logo" aria-label="Frankie Fan's Memos">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Frankie Fan's Memos
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Setup Jenkins Pipeline and Blue Ocean in Kubernetes
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://hustakin.github.io" title="Frankie Fan&#39;s Memos" class="md-nav__button md-logo" aria-label="Frankie Fan's Memos">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Frankie Fan's Memos
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
    <label class="md-nav__link" for="nav-2">
      DevOps
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="DevOps" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        DevOps
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/important-linux-commands/" class="md-nav__link">
      Important linux commands
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/important-docker-commands/" class="md-nav__link">
      Important Docker commands
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/getting-started-with-kubernetes/" class="md-nav__link">
      Getting started with Kubernetes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/amazon-ec2-101/" class="md-nav__link">
      Amazon EC2 101
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/getting-started-with-vagrant/" class="md-nav__link">
      Getting started with Vagrant
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/things-todo-after-installing-ubuntu/" class="md-nav__link">
      Things to do after installing Ubuntu 20.04.1 LTS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../setup-vncserver-for-ubuntu/" class="md-nav__link">
      Using VNC to Operate a Desktop on Ubuntu 18.04
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    <label class="md-nav__link" for="nav-3">
      CI/CD
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="CI/CD" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        CI/CD
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../use-github-actions-to-build-multi-envs-ci/" class="md-nav__link">
      Setup CI in Github Actions for multiple environments regarding SpringBoot or Angular
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Setup Jenkins Pipeline and Blue Ocean in Kubernetes
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Setup Jenkins Pipeline and Blue Ocean in Kubernetes
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#install-jenkins-in-k8s" class="md-nav__link">
    Install Jenkins in K8s
  </a>
  
    <nav class="md-nav" aria-label="Install Jenkins in K8s">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-namespace" class="md-nav__link">
    Create namespace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-jenkins-containers" class="md-nav__link">
    Create Jenkins containers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage-yaml" class="md-nav__link">
    Storage yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rbac-yaml" class="md-nav__link">
    RBAC yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jenkins-yaml" class="md-nav__link">
    Jenkins yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wait-until-running" class="md-nav__link">
    Wait until running
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#login-jenkins" class="md-nav__link">
    Login Jenkins
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-plugins" class="md-nav__link">
    Install plugins
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jenkins-slave-image" class="md-nav__link">
    Jenkins Slave Image
  </a>
  
    <nav class="md-nav" aria-label="Jenkins Slave Image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kuberctl-replace" class="md-nav__link">
    Kuberctl replace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dockerfile" class="md-nav__link">
    Dockerfile
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jenkins-configurations" class="md-nav__link">
    Jenkins Configurations
  </a>
  
    <nav class="md-nav" aria-label="Jenkins Configurations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configure-kubernetes" class="md-nav__link">
    Configure Kubernetes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-jenkins-slave-k8s-template" class="md-nav__link">
    Configure Jenkins Slave k8s template
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-jenkins-slave-k8s-volumes" class="md-nav__link">
    Configure Jenkins Slave k8s volumes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-service-account" class="md-nav__link">
    Configure service account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-global-tool" class="md-nav__link">
    Configure global tool
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-nodejs-installations" class="md-nav__link">
    Configure NodeJS installations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-dockerhub-credentials" class="md-nav__link">
    Configure DockerHub credentials
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-pipelines" class="md-nav__link">
    Configure Pipelines
  </a>
  
    <nav class="md-nav" aria-label="Configure Pipelines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jenkinsfile-content-for-springboot" class="md-nav__link">
    Jenkinsfile content for SpringBoot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dockerfile-content-for-springboot" class="md-nav__link">
    Dockerfile content for SpringBoot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k8s-content-for-springboot" class="md-nav__link">
    K8s content for SpringBoot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jenkinsfile-content-for-angular" class="md-nav__link">
    Jenkinsfile content for Angular
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dockerfile-content-for-angular" class="md-nav__link">
    Dockerfile content for Angular
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nginx-conf-content-for-angular" class="md-nav__link">
    Nginx conf content for Angular
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k8s-content-for-angular" class="md-nav__link">
    K8s content for Angular
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-github-pipeline" class="md-nav__link">
    Create Github Pipeline
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-github-pipeline_1" class="md-nav__link">
    Create Github Pipeline
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trigger-pipeline" class="md-nav__link">
    Trigger pipeline
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blue-ocean-build" class="md-nav__link">
    Blue Ocean build
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../continuous-integration-with-jenkins-and-docker/" class="md-nav__link">
      Continuous Integration with Jenkins and Docker
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" >
    <label class="md-nav__link" for="nav-4">
      AWS
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="AWS" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        AWS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/create-cicd-pipeline-test-prod-env-for-web-with-aws-amplify/" class="md-nav__link">
      Create the CI/CD pipeline and test&prod environments for web app with AWS Amplify
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" >
    <label class="md-nav__link" for="nav-5">
      Kubernetes
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Kubernetes" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Kubernetes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../keycloak-traefik-k8s/" class="md-nav__link">
      Play around with Keycloak in k8s
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../build-ceph-and-k8s-based-distributed-file-storage-system/" class="md-nav__link">
      Build Ceph and Kubernetes based distributed file storage system
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" >
    <label class="md-nav__link" for="nav-6">
      Flutter
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Flutter" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        Flutter
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../auto-generate-flutter-imgs/" class="md-nav__link">
      Generate required flutter app screenshots for different devices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../flutter-app-distribution-for-testing/" class="md-nav__link">
      How to make flutter app distribution  for testing in Firebase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../create--app-icon-launch-screen-for-flutter/" class="md-nav__link">
      How to create an app icon and launch screen for flutter
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" >
    <label class="md-nav__link" for="nav-7">
      Monitoring
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Monitoring" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon"></span>
        Monitoring
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../integrate-google-analytics-with-web-app/" class="md-nav__link">
      Integrate Google Analytics with a web application
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../introduce-rollbar-and-slack-for-realtime-exception-alerts/" class="md-nav__link">
      Introduce Rollbar and Slack for realtime exception alerts
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" >
    <label class="md-nav__link" for="nav-8">
      GeoServer
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="GeoServer" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon"></span>
        GeoServer
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../developing-based-on-geoserver-restful-api/" class="md-nav__link">
      Developing based on GeoServer restful api
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../serve-raster-tiles-in-geoserver/" class="md-nav__link">
      Serve raster tiles in GeoServer
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9" >
    <label class="md-nav__link" for="nav-9">
      Tools 101
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Tools 101" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        <span class="md-nav__icon md-icon"></span>
        Tools 101
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tools/hexo-get-started/" class="md-nav__link">
      Hexo get started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tools/getting-started-with-mitmproxy/" class="md-nav__link">
      Getting started on mitmproxy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../adding-beautiful-badges-into-the-markdown/" class="md-nav__link">
      Adding beautiful badges into the markdown
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tools/google-search-console/" class="md-nav__link">
      Manage your website in Google Search Console
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tools/setup-cloud9-dev-env/" class="md-nav__link">
      Setup the development environment on AWS Cloud9 for coding and testing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10" >
    <label class="md-nav__link" for="nav-10">
      Life Experience
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Life Experience" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        <span class="md-nav__icon md-icon"></span>
        Life Experience
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../life/how-to-rent-a-house-in-australia/" class="md-nav__link">
      How to rent a house in Australia
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../life/international-money-transfer-from-commanwealth-bank-to-china/" class="md-nav__link">
      International money transfer from CommonWealth bank to China
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../life/a-detail-list-for-updating-address-when-moving/" class="md-nav__link">
      A detailed list for updating address when moving
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#install-jenkins-in-k8s" class="md-nav__link">
    Install Jenkins in K8s
  </a>
  
    <nav class="md-nav" aria-label="Install Jenkins in K8s">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-namespace" class="md-nav__link">
    Create namespace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-jenkins-containers" class="md-nav__link">
    Create Jenkins containers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage-yaml" class="md-nav__link">
    Storage yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rbac-yaml" class="md-nav__link">
    RBAC yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jenkins-yaml" class="md-nav__link">
    Jenkins yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wait-until-running" class="md-nav__link">
    Wait until running
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#login-jenkins" class="md-nav__link">
    Login Jenkins
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-plugins" class="md-nav__link">
    Install plugins
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jenkins-slave-image" class="md-nav__link">
    Jenkins Slave Image
  </a>
  
    <nav class="md-nav" aria-label="Jenkins Slave Image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kuberctl-replace" class="md-nav__link">
    Kuberctl replace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dockerfile" class="md-nav__link">
    Dockerfile
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jenkins-configurations" class="md-nav__link">
    Jenkins Configurations
  </a>
  
    <nav class="md-nav" aria-label="Jenkins Configurations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configure-kubernetes" class="md-nav__link">
    Configure Kubernetes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-jenkins-slave-k8s-template" class="md-nav__link">
    Configure Jenkins Slave k8s template
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-jenkins-slave-k8s-volumes" class="md-nav__link">
    Configure Jenkins Slave k8s volumes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-service-account" class="md-nav__link">
    Configure service account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-global-tool" class="md-nav__link">
    Configure global tool
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-nodejs-installations" class="md-nav__link">
    Configure NodeJS installations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-dockerhub-credentials" class="md-nav__link">
    Configure DockerHub credentials
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-pipelines" class="md-nav__link">
    Configure Pipelines
  </a>
  
    <nav class="md-nav" aria-label="Configure Pipelines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jenkinsfile-content-for-springboot" class="md-nav__link">
    Jenkinsfile content for SpringBoot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dockerfile-content-for-springboot" class="md-nav__link">
    Dockerfile content for SpringBoot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k8s-content-for-springboot" class="md-nav__link">
    K8s content for SpringBoot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jenkinsfile-content-for-angular" class="md-nav__link">
    Jenkinsfile content for Angular
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dockerfile-content-for-angular" class="md-nav__link">
    Dockerfile content for Angular
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nginx-conf-content-for-angular" class="md-nav__link">
    Nginx conf content for Angular
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k8s-content-for-angular" class="md-nav__link">
    K8s content for Angular
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-github-pipeline" class="md-nav__link">
    Create Github Pipeline
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-github-pipeline_1" class="md-nav__link">
    Create Github Pipeline
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trigger-pipeline" class="md-nav__link">
    Trigger pipeline
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blue-ocean-build" class="md-nav__link">
    Blue Ocean build
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Setup Jenkins Pipeline and Blue Ocean in Kubernetes</h1>
                
                <p>Jenkins Pipeline (or simply "Pipeline" with a capital "P") is a suite of plugins which supports implementing and integrating continuous delivery pipelines into Jenkins.</p>
<p>Blue Ocean rethinks the user experience of Jenkins. Designed from the ground up for Jenkins Pipeline, but still compatible with freestyle jobs, Blue Ocean reduces clutter and increases clarity for every member of the team.</p>
<p><img alt="Jenkins pipeline" src="/imgs/jenkins-pipeline-k8s/jenkins-pipeline.png" /></p>
<!-- more -->

<h2 id="install-jenkins-in-k8s">Install Jenkins in K8s</h2>
<h3 id="create-namespace">Create namespace</h3>
<div class="highlight"><pre><span></span><code>kubectl create namespace devops
</code></pre></div>
<h3 id="create-jenkins-containers">Create Jenkins containers</h3>
<p>Create pv/pvc/deployment/service/ingress by yaml files
<div class="highlight"><pre><span></span><code>kubectl create -f ops-storage.yml
kubectl create -f rbac.yml
kubectl create -f jenkins.yml
</code></pre></div></p>
<h3 id="storage-yaml">Storage yaml</h3>
<p>The content of ops-storage.yml is as bellow.
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">opspv</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">capacity</span><span class="p">:</span>
    <span class="nt">storage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">20Gi</span>
  <span class="nt">accessModes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
  <span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Retain</span>
  <span class="nt">storageClassName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">local-storage</span>
  <span class="nt">local</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/mnt/data</span>
  <span class="nt">nodeAffinity</span><span class="p">:</span>
    <span class="nt">required</span><span class="p">:</span>
      <span class="nt">nodeSelectorTerms</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">matchExpressions</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">node</span>
              <span class="nt">operator</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">In</span>
              <span class="nt">values</span><span class="p">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">dev</span>
<span class="nn">---</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">opspvc</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">devops</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">accessModes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
  <span class="nt">storageClassName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">local-storage</span>
  <span class="nt">resources</span><span class="p">:</span>
    <span class="nt">requests</span><span class="p">:</span>
      <span class="nt">storage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">20Gi</span>
</code></pre></div></p>
<h3 id="rbac-yaml">RBAC yaml</h3>
<p>The content of rbac.yml is as bellow.
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">devops</span>
<span class="nn">---</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1beta1</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins</span>
<span class="nt">rules</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">apiGroups</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;extensions&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;apps&quot;</span><span class="p p-Indicator">]</span>
    <span class="nt">resources</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;deployments&quot;</span><span class="p p-Indicator">]</span>
    <span class="nt">verbs</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;create&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;delete&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;list&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;watch&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;patch&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;update&quot;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="nt">apiGroups</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;&quot;</span><span class="p p-Indicator">]</span>
    <span class="nt">resources</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;services&quot;</span><span class="p p-Indicator">]</span>
    <span class="nt">verbs</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;create&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;delete&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;list&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;watch&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;patch&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;update&quot;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="nt">apiGroups</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;&quot;</span><span class="p p-Indicator">]</span>
    <span class="nt">resources</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;pods&quot;</span><span class="p p-Indicator">]</span>
    <span class="nt">verbs</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;create&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;delete&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;patch&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;update&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;watch&quot;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="nt">apiGroups</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;&quot;</span><span class="p p-Indicator">]</span>
    <span class="nt">resources</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;pods/exec&quot;</span><span class="p p-Indicator">]</span>
    <span class="nt">verbs</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;create&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;delete&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;patch&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;update&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;watch&quot;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="nt">apiGroups</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;&quot;</span><span class="p p-Indicator">]</span>
    <span class="nt">resources</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;pods/log&quot;</span><span class="p p-Indicator">]</span>
    <span class="nt">verbs</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;watch&quot;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="nt">apiGroups</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;&quot;</span><span class="p p-Indicator">]</span>
    <span class="nt">resources</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;secrets&quot;</span><span class="p p-Indicator">]</span>
    <span class="nt">verbs</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">]</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">devops</span>
<span class="nt">roleRef</span><span class="p">:</span>
  <span class="nt">apiGroup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
  <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins</span>
<span class="nt">subjects</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins</span>
    <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">devops</span>
</code></pre></div></p>
<h3 id="jenkins-yaml">Jenkins yaml</h3>
<p>The content of jenkins.yml is as bellow. Remember to replace the Traefik ingress configuration [domain] to your domain.
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">devops</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">metadata</span><span class="p">:</span>
      <span class="nt">labels</span><span class="p">:</span>
        <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins</span>
    <span class="nt">spec</span><span class="p">:</span>
      <span class="nt">terminationGracePeriodSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
      <span class="nt">serviceAccount</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins</span>
      <span class="nt">containers</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins</span>
          <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins/jenkins:lts</span>
          <span class="nt">imagePullPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
          <span class="nt">ports</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">containerPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
              <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">web</span>
              <span class="nt">protocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
            <span class="p p-Indicator">-</span> <span class="nt">containerPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">50000</span>
              <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">agent</span>
              <span class="nt">protocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
          <span class="nt">resources</span><span class="p">:</span>
            <span class="nt">limits</span><span class="p">:</span>
              <span class="nt">cpu</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1000m</span>
              <span class="nt">memory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1Gi</span>
            <span class="nt">requests</span><span class="p">:</span>
              <span class="nt">cpu</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">500m</span>
              <span class="nt">memory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">512Mi</span>
          <span class="nt">livenessProbe</span><span class="p">:</span>
            <span class="nt">httpGet</span><span class="p">:</span>
              <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/login</span>
              <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
            <span class="nt">initialDelaySeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">60</span>
            <span class="nt">timeoutSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
            <span class="nt">failureThreshold</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">12</span>
          <span class="nt">readinessProbe</span><span class="p">:</span>
            <span class="nt">httpGet</span><span class="p">:</span>
              <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/login</span>
              <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
            <span class="nt">initialDelaySeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">60</span>
            <span class="nt">timeoutSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
            <span class="nt">failureThreshold</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">12</span>
          <span class="nt">volumeMounts</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jenkinshome</span>
              <span class="nt">subPath</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins</span>
              <span class="nt">mountPath</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/jenkins_home</span>
          <span class="nt">env</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LIMITS_MEMORY</span>
              <span class="nt">valueFrom</span><span class="p">:</span>
                <span class="nt">resourceFieldRef</span><span class="p">:</span>
                  <span class="nt">resource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">limits.memory</span>
                  <span class="nt">divisor</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1Mi</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">JAVA_OPTS</span>
              <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">-Xmx$(LIMITS_MEMORY)m -XshowSettings:vm -Dhudson.slaves.NodeProvisioner.initialDelay=0 -Dhudson.slaves.NodeProvisioner.MARGIN=50 -Dhudson.slaves.NodeProvisioner.MARGIN0=0.85 -Duser.timezone=Asia/Shanghai</span>
      <span class="nt">securityContext</span><span class="p">:</span>
        <span class="nt">fsGroup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1000</span>
      <span class="nt">volumes</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jenkinshome</span>
          <span class="nt">persistentVolumeClaim</span><span class="p">:</span>
            <span class="nt">claimName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">opspvc</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">devops</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">selector</span><span class="p">:</span>
    <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">NodePort</span>
  <span class="nt">ports</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">web</span>
      <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
      <span class="nt">targetPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">web</span>
      <span class="nt">nodePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30002</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">agent</span>
      <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">50000</span>
      <span class="nt">targetPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">agent</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins-ingress</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">devops</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">rules</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">host</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">domain</span><span class="p p-Indicator">]</span>
      <span class="nt">http</span><span class="p">:</span>
        <span class="nt">paths</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
            <span class="nt">backend</span><span class="p">:</span>
              <span class="nt">serviceName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins</span>
              <span class="nt">servicePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">web</span>
</code></pre></div></p>
<h3 id="wait-until-running">Wait until running</h3>
<p>Check if pods runs
<div class="highlight"><pre><span></span><code>kubectl get pods -n devops
</code></pre></div></p>
<h3 id="login-jenkins">Login Jenkins</h3>
<p>Check the Jenkins password and login, then install plugins.
<div class="highlight"><pre><span></span><code><span class="c1">#Please check the jenkins startup logs or check the content in this file</span>
cat /mnt/data/jenkins/secrets/initialAdminPassword
</code></pre></div></p>
<h3 id="install-plugins">Install plugins</h3>
<p>Installed plugins include:
* Blue Ocean
* Kubernetes plugin (Job and Stage Monitoring Plugin)
* NodeJS Plugin
* Embeddable Build Status Plugin</p>
<h2 id="jenkins-slave-image">Jenkins Slave Image</h2>
<p>Jenkins Slave jobs will run in your Kubernetes cluster, so it is important that the kubectl version for you Kubernetes cluster is the same with the Jenkins Slave docker image, otherwise you may meet some version conflict issues for Jenkins Pipelines jobs.</p>
<p>I build my own Jenkins Slave docker image hustakin/jenkins-slave:latest with the kubectl version v1.14.2. For different version, you should build your own jenkins slave docker image with another kubectl version based on image cnych/jenkins:jnlp.</p>
<h3 id="kuberctl-replace">Kuberctl replace</h3>
<p>The easiest way to customize different version kubectl is to replace the executable file "kubectl" from image cnych/jenkins:jnlp. You can find the file in your kubernetes cluster or download it.
<div class="highlight"><pre><span></span><code><span class="c1">#Find current kubectl</span>
which kubectl
<span class="c1">#/usr/bin/kubectl</span>

<span class="c1">#Download v1.14.2 kubectl and modify it to executable</span>
curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.14.2/bin/darwin/amd64/kubectl
chmod +x ./kubectl
</code></pre></div></p>
<h3 id="dockerfile">Dockerfile</h3>
<p>Copy the kubectl file to current folder and build the Dockerfile.
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="s"> cnych/jenkins:jnlp</span>
<span class="k">MAINTAINER</span><span class="s"> Frankie Fan &quot;hustakin@gmail.com&quot;</span>
<span class="k">ENV</span> REFRESHED_AT <span class="m">2019</span>-6-26
<span class="k">COPY</span> kubectl /usr/local/bin/kubectl
<span class="k">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&quot;jenkins-slave&quot;</span><span class="p">]</span>
</code></pre></div></p>
<h2 id="jenkins-configurations">Jenkins Configurations</h2>
<h3 id="configure-kubernetes">Configure Kubernetes</h3>
<p>Click Manage Jenkins-&gt;Configure System-&gt;Add a new cloud-&gt;Kubernetes. Test the connection and input namespace and Jenkins inner url by format (<serviceName>.<namespace>.svc.cluster.local:8080)
<img alt="Jenkins k8s" src="/imgs/jenkins-pipeline-k8s/jenkins-k8s.png" /></p>
<h3 id="configure-jenkins-slave-k8s-template">Configure Jenkins Slave k8s template</h3>
<p>Add pod template, and remember to clean the "Command to run" and "Arguments to pass to the command" (This's really important!).</p>
<p>The image hustakin/jenkins-slave:latest has the kubectl version of v1.14.2
<img alt="Jenkins k8s pod" src="/imgs/jenkins-pipeline-k8s/jenkins-k8s-pod.png" /></p>
<h3 id="configure-jenkins-slave-k8s-volumes">Configure Jenkins Slave k8s volumes</h3>
<p>Add volumes in the pod template including docker, .kube config files as well as the maven cache. (Each node of the cluster will cache the maven into /home/ec2-user/.m2)
<img alt="Jenkins k8s volume" src="/imgs/jenkins-pipeline-k8s/jenkins-k8s-volume.png" /></p>
<h3 id="configure-service-account">Configure service account</h3>
<p>The service account is created in previous RBAC yaml step.
<img alt="Jenkins service account" src="/imgs/jenkins-pipeline-k8s/jenkins-service-account.png" /></p>
<h3 id="configure-global-tool">Configure global tool</h3>
<p>Click Manage Jenkins-&gt;Global Tool Configuration. Configure maven installations.
<img alt="Jenkins maven" src="/imgs/jenkins-pipeline-k8s/jenkins-maven.png" /></p>
<h3 id="configure-nodejs-installations">Configure NodeJS installations</h3>
<p>Click Manage Jenkins-&gt;Global Tool Configuration. Configure NodeJS installations.
<img alt="Jenkins nodejs" src="/imgs/jenkins-pipeline-k8s/jenkins-nodejs.png" /></p>
<h3 id="configure-dockerhub-credentials">Configure DockerHub credentials</h3>
<p>Click Jenkins-&gt;Credentials-&gt;(global)-&gt;Add credentials. Specify your DockerHub username and password. Remember the ID here will be used in your Jenkinsfile to specify "credentialsId".
<img alt="Jenkins dockerhub" src="/imgs/jenkins-pipeline-k8s/jenkins-dockerhub.png" /></p>
<h2 id="configure-pipelines">Configure Pipelines</h2>
<p>Write Dockerfile and Jenkinsfile and k8s.yaml in your project root folder and push it to GitHub. Create the repository in Dockerhub for your project in order to save docker built images.</p>
<h3 id="jenkinsfile-content-for-springboot">Jenkinsfile content for SpringBoot</h3>
<p>The Jenkinsfile content is as bellow
<div class="highlight"><pre><span></span><code>node(&#39;jenkins-jnlp&#39;) {
    env.MVN_HOME = &quot;${tool &#39;Maven&#39;}&quot;
    env.PATH=&quot;${env.MVN_HOME}/bin:${env.PATH}&quot;

    stage(&#39;Prepare&#39;) {
        echo &quot;1.Prepare Stage&quot;
        checkout scm
        script {
            build_tag = sh(returnStdout: true, script: &#39;git rev-parse --short HEAD&#39;).trim()
            if (env.BRANCH_NAME != &#39;master&#39;) {
                build_tag = &quot;${env.BRANCH_NAME}-${build_tag}&quot;
            }
        }
    }
    stage(&#39;Compile&#39;) {
        echo &quot;2.Compile SpringBoot App Stage&quot;
        sh &quot;mvn clean package -Dmaven.test.skip=true&quot;
    }
    stage(&#39;Build&#39;) {
        echo &quot;3.Build Docker Image Stage&quot;
        sh &quot;docker build -t hustakin/test:${build_tag} .&quot;
    }
    stage(&#39;Push&#39;) {
        echo &quot;4.Push Docker Image Stage&quot;
        withCredentials([usernamePassword(credentialsId: &#39;dockerHub&#39;, passwordVariable: &#39;dockerHubPassword&#39;, usernameVariable: &#39;dockerHubUser&#39;)]) {
            sh &quot;docker login -u ${dockerHubUser} -p ${dockerHubPassword}&quot;
            sh &quot;docker push hustakin/test:${build_tag}&quot;
        }
    }
    stage(&#39;Deploy&#39;) {
        echo &quot;5. Deploy To K8S Cluster Stage&quot;
        sh &quot;sed -i &#39;s/&lt;BUILD_TAG&gt;/${build_tag}/&#39; k8s.yaml&quot;
        sh &quot;sed -i &#39;s/&lt;BRANCH_NAME&gt;/${env.BRANCH_NAME}/&#39; k8s.yaml&quot;
        sh &quot;kubectl apply -f k8s.yaml --record&quot;
    }
}
</code></pre></div></p>
<h3 id="dockerfile-content-for-springboot">Dockerfile content for SpringBoot</h3>
<p>The Dockerfile content is as bellow
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="s"> openjdk:8-jre</span>
<span class="k">MAINTAINER</span><span class="s"> Frankie Fan &quot;hustakin@gmail.com&quot;</span>
<span class="k">ENV</span> REFRESHED_AT <span class="m">2019</span>-7-3
<span class="k">VOLUME</span><span class="s"> /tmp</span>
<span class="k">ADD</span> web/target/test.jar test.jar
<span class="k">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&quot;java&quot;</span><span class="p">,</span><span class="s2">&quot;-XX:-BytecodeVerificationLocal&quot;</span><span class="p">,</span><span class="s2">&quot;-XX:-BytecodeVerificationRemote&quot;</span><span class="p">,</span><span class="s2">&quot;-XX:CICompilerCount=3&quot;</span><span class="p">,</span><span class="s2">&quot;-XX:InitialHeapSize=268435456&quot;</span><span class="p">,</span><span class="s2">&quot;-XX:+ManagementServer&quot;</span><span class="p">,</span><span class="s2">&quot;-XX:MaxHeapSize=4263510016&quot;</span><span class="p">,</span><span class="s2">&quot;-XX:MaxNewSize=2147483648&quot;</span><span class="p">,</span><span class="s2">&quot;-XX:MinHeapDeltaBytes=524288&quot;</span><span class="p">,</span><span class="s2">&quot;-XX:NewSize=89128960&quot;</span><span class="p">,</span><span class="s2">&quot;-XX:OldSize=179306496&quot;</span><span class="p">,</span><span class="s2">&quot;-XX:TieredStopAtLevel=1&quot;</span><span class="p">,</span><span class="s2">&quot;-XX:+UseCompressedClassPointers&quot;</span><span class="p">,</span><span class="s2">&quot;-XX:+UseCompressedOops&quot;</span><span class="p">,</span><span class="s2">&quot;-XX:-UseLargePagesIndividualAllocation&quot;</span><span class="p">,</span><span class="s2">&quot;-XX:+UseParallelGC&quot;</span><span class="p">,</span><span class="s2">&quot;-Djava.security.egd=file:/dev/./urandom&quot;</span><span class="p">,</span><span class="s2">&quot;-Dspring.profiles.active=dev&quot;</span><span class="p">,</span><span class="s2">&quot;-jar&quot;</span><span class="p">,</span><span class="s2">&quot;/test.jar&quot;</span><span class="p">]</span>
<span class="k">EXPOSE</span><span class="s"> 80 443</span>
</code></pre></div></p>
<h3 id="k8s-content-for-springboot">K8s content for SpringBoot</h3>
<p>The k8s.yaml content is as bellow
<div class="highlight"><pre><span></span><code><span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test-server</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">agric</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">replicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
  <span class="nt">minReadySeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
  <span class="nt">strategy</span><span class="p">:</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">RollingUpdate</span>
    <span class="nt">rollingUpdate</span><span class="p">:</span>
      <span class="nt">maxUnavailable</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">maxSurge</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">metadata</span><span class="p">:</span>
      <span class="nt">labels</span><span class="p">:</span>
        <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test-server</span>
    <span class="nt">spec</span><span class="p">:</span>
      <span class="nt">containers</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test-server</span>
          <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hustakin/test:&lt;BUILD_TAG&gt;</span>
          <span class="nt">env</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">branch</span>
              <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;BRANCH_NAME&gt;</span>
          <span class="nt">ports</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">containerPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
              <span class="nt">protocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
              <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">web</span>
            <span class="p p-Indicator">-</span> <span class="nt">containerPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">443</span>
              <span class="nt">protocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
              <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https</span>
          <span class="c1"># inventory probe</span>
          <span class="nt">readinessProbe</span><span class="p">:</span>
            <span class="nt">httpGet</span><span class="p">:</span>
              <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/ready</span>
              <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
            <span class="nt">initialDelaySeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">15</span>
            <span class="nt">periodSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
            <span class="nt">failureThreshold</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
      <span class="nt">imagePullSecrets</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">docker-hub</span>
</code></pre></div></p>
<h3 id="jenkinsfile-content-for-angular">Jenkinsfile content for Angular</h3>
<p>The Jenkinsfile content is as bellow
<div class="highlight"><pre><span></span><code>node(&#39;jenkins-jnlp&#39;) {
    env.NODEJS_HOME = &quot;${tool &#39;Node&#39;}&quot;
    env.PATH=&quot;${env.NODEJS_HOME}/bin:${env.PATH}&quot;

    stage(&#39;Prepare&#39;) {
        echo &quot;1.Prepare Stage&quot;
        checkout scm
        script {
            build_tag = sh(returnStdout: true, script: &#39;git rev-parse --short HEAD&#39;).trim()
            if (env.BRANCH_NAME != &#39;master&#39;) {
                build_tag = &quot;${env.BRANCH_NAME}-${build_tag}&quot;
            }
        }
    }
    stage(&#39;Compile&#39;) {
        echo &quot;2.Compile Angular App Stage&quot;
        sh &quot;npm install&quot;
        sh &quot;npm install node-sass&quot;
        sh &quot;npm run prod&quot;
    }
    stage(&#39;Build&#39;) {
        echo &quot;3.Build Docker Image Stage&quot;
        sh &quot;docker build -t hustakin/test-front:${build_tag} .&quot;
    }
    stage(&#39;Push&#39;) {
        echo &quot;4.Push Docker Image Stage&quot;
        withCredentials([usernamePassword(credentialsId: &#39;dockerHub&#39;, passwordVariable: &#39;dockerHubPassword&#39;, usernameVariable: &#39;dockerHubUser&#39;)]) {
            sh &quot;docker login -u ${dockerHubUser} -p ${dockerHubPassword}&quot;
            sh &quot;docker push hustakin/test-front:${build_tag}&quot;
        }
    }
    stage(&#39;Deploy&#39;) {
        echo &quot;5. Deploy To K8S Cluster Stage&quot;
        sh &quot;sed -i &#39;s/&lt;BUILD_TAG&gt;/${build_tag}/&#39; k8s.yaml&quot;
        sh &quot;sed -i &#39;s/&lt;BRANCH_NAME&gt;/${env.BRANCH_NAME}/&#39; k8s.yaml&quot;
        sh &quot;kubectl apply -f k8s.yaml --record&quot;
    }
}
</code></pre></div></p>
<h3 id="dockerfile-content-for-angular">Dockerfile content for Angular</h3>
<p>The Dockerfile content is as bellow
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="s"> nginx:1.16.0</span>
<span class="k">MAINTAINER</span><span class="s"> Frankie Fan &quot;hustakin@gmail.com&quot;</span>
<span class="k">ENV</span> REFRESHED_AT <span class="m">2019</span>-6-5
<span class="k">COPY</span> nginx/default.conf /etc/nginx/conf.d/
<span class="k">RUN</span> rm -rf /usr/share/nginx/html/*
<span class="k">COPY</span> /dist /usr/share/nginx/html
<span class="k">CMD</span> <span class="p">[</span><span class="s2">&quot;nginx&quot;</span><span class="p">,</span> <span class="s2">&quot;-g&quot;</span><span class="p">,</span> <span class="s2">&quot;daemon off;&quot;</span><span class="p">]</span>
<span class="k">EXPOSE</span><span class="s"> 80</span>
</code></pre></div></p>
<h3 id="nginx-conf-content-for-angular">Nginx conf content for Angular</h3>
<p>The nginx/default.conf content is as bellow.
<div class="highlight"><pre><span></span><code><span class="k">server</span> <span class="p">{</span>
  <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
  <span class="kn">sendfile</span> <span class="no">on</span><span class="p">;</span>
  <span class="kn">default_type</span> <span class="s">application/octet-stream</span><span class="p">;</span>
  <span class="kn">gzip</span> <span class="no">on</span><span class="p">;</span>
  <span class="kn">gzip_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
  <span class="kn">gzip_disable</span>      <span class="s">&quot;MSIE</span> <span class="s">[1-6]\.&quot;</span><span class="p">;</span>
  <span class="kn">gzip_min_length</span>   <span class="mi">256</span><span class="p">;</span>
  <span class="kn">gzip_vary</span>         <span class="no">on</span><span class="p">;</span>
  <span class="kn">gzip_proxied</span>      <span class="s">expired</span> <span class="s">no-cache</span> <span class="s">no-store</span> <span class="s">private</span> <span class="s">auth</span><span class="p">;</span>
  <span class="kn">gzip_types</span>        <span class="s">text/plain</span> <span class="s">text/css</span> <span class="s">application/json</span> <span class="s">application/javascript</span> <span class="s">application/x-javascript</span> <span class="s">text/xml</span> <span class="s">application/xml</span> <span class="s">application/xml+rss</span> <span class="s">text/javascript</span><span class="p">;</span>
  <span class="kn">gzip_comp_level</span>   <span class="mi">9</span><span class="p">;</span>
  <span class="kn">root</span> <span class="s">/usr/share/nginx/html</span><span class="p">;</span>
  <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
    <span class="kn">try_files</span> <span class="nv">$uri</span> <span class="nv">$uri/</span> <span class="s">/index.html</span> <span class="p">=</span><span class="mi">404</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="k8s-content-for-angular">K8s content for Angular</h3>
<p>The k8s.yaml content is as bellow
<div class="highlight"><pre><span></span><code><span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test-front-dev</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">agric</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">replicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
  <span class="nt">minReadySeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
  <span class="nt">strategy</span><span class="p">:</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">RollingUpdate</span>
    <span class="nt">rollingUpdate</span><span class="p">:</span>
      <span class="nt">maxUnavailable</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">maxSurge</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">metadata</span><span class="p">:</span>
      <span class="nt">labels</span><span class="p">:</span>
        <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test-front-dev</span>
    <span class="nt">spec</span><span class="p">:</span>
      <span class="nt">containers</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test-front-dev</span>
          <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hustakin/test-front:&lt;BUILD_TAG&gt;</span>
          <span class="nt">env</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">branch</span>
              <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;BRANCH_NAME&gt;</span>
          <span class="nt">ports</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">containerPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
              <span class="nt">protocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
              <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">web</span>
            <span class="p p-Indicator">-</span> <span class="nt">containerPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">443</span>
              <span class="nt">protocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
              <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https</span>
      <span class="nt">imagePullSecrets</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">docker-hub</span>
</code></pre></div></p>
<h3 id="create-github-pipeline">Create Github Pipeline</h3>
<p>Click Jenkins-&gt;Open Blue Ocean-&gt;New Pipeline, and create pipeline for your project.
<img alt="Github pipeline" src="/imgs/jenkins-pipeline-k8s/jenkins-new-pipeline.png" /></p>
<h3 id="create-github-pipeline_1">Create Github Pipeline</h3>
<p>The jenkins pipeline should work now. Enter your jenkins job and master branch, you could see the stage view here.
<img alt="Github pipeline branch" src="/imgs/jenkins-pipeline-k8s/jenkins-pipeline-branch.png" /></p>
<h3 id="trigger-pipeline">Trigger pipeline</h3>
<p>Push your code changes to Github. Click Jenkins-&gt;Open Blue Ocean. You can trigger the build for all pipelines you created by clicking the Run button.
<img alt="Blue Ocean pipeline" src="/imgs/jenkins-pipeline-k8s/blue-ocean-pipeline.png" /></p>
<h3 id="blue-ocean-build">Blue Ocean build</h3>
<p>Click Jenkins-&gt;Open Blue Ocean, and click the pipeline you just created, you will see the Jenkinsfile stages and related logs here.
<img alt="Blue Ocean build" src="/imgs/jenkins-pipeline-k8s/blue-ocean-deploy.png" /></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../use-github-actions-to-build-multi-envs-ci/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Setup CI in Github Actions for multiple environments regarding SpringBoot or Angular
              </div>
            </div>
          </a>
        
        
          <a href="../continuous-integration-with-jenkins-and-docker/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Continuous Integration with Jenkins and Docker
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 Frankie Fan
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/hustakin" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://linkedin.com/in/hustakin" target="_blank" rel="noopener" title="linkedin.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://twitter.com/hustakin" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://instagram.com/hustakin" target="_blank" rel="noopener" title="instagram.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.0ac82a11.min.js"></script>
      <script src="../../assets/javascripts/bundle.f81dfb4d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>