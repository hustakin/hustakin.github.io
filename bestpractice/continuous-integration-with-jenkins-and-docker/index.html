



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://hustakin.github.io/bestpractice/continuous-integration-with-jenkins-and-docker/">
      
      
        <meta name="author" content="Frankie Fan">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Continuous Integration with Jenkins and Docker</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-146443611-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#install" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://hustakin.github.io" title="Frankie Fan's Memos" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Frankie Fan's Memos
            </span>
            <span class="md-header-nav__topic">
              
                Continuous Integration with Jenkins and Docker
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://hustakin.github.io" title="Frankie Fan's Memos" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Frankie Fan's Memos
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      DevOps
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        DevOps
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/important-linux-commands/" title="Important linux commands" class="md-nav__link">
      Important linux commands
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/important-docker-commands/" title="Important Docker commands" class="md-nav__link">
      Important Docker commands
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/getting-started-with-kubernetes/" title="Getting started with Kubernetes" class="md-nav__link">
      Getting started with Kubernetes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/amazon-ec2-101/" title="Amazon EC2 101" class="md-nav__link">
      Amazon EC2 101
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/getting-started-with-vagrant/" title="Getting started with Vagrant" class="md-nav__link">
      Getting started with Vagrant
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Best Practice
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Best Practice
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../setup-vncserver-for-ubuntu/" title="Using VNC to Operate a Desktop on Ubuntu 18.04" class="md-nav__link">
      Using VNC to Operate a Desktop on Ubuntu 18.04
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../integrate-google-analytics-with-web-app/" title="Integrate Google Analytics with a web application" class="md-nav__link">
      Integrate Google Analytics with a web application
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../adding-beautiful-badges-into-the-markdown/" title="Adding beautiful badges into the markdown" class="md-nav__link">
      Adding beautiful badges into the markdown
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../setup-jenkins-pipeline-in-kubernetes/" title="Setup Jenkins Pipeline and Blue Ocean in Kubernetes" class="md-nav__link">
      Setup Jenkins Pipeline and Blue Ocean in Kubernetes
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Continuous Integration with Jenkins and Docker
      </label>
    
    <a href="./" title="Continuous Integration with Jenkins and Docker" class="md-nav__link md-nav__link--active">
      Continuous Integration with Jenkins and Docker
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#install" title="Install" class="md-nav__link">
    Install
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-docker" title="Install docker" class="md-nav__link">
    Install docker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-docker-compose" title="Install docker-compose" class="md-nav__link">
    Install docker-compose
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-jenkins-container" title="Create jenkins container" class="md-nav__link">
    Create jenkins container
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-ssh-key" title="Deploy SSH key" class="md-nav__link">
    Deploy SSH key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restart-the-ssh-service" title="Restart the SSH service" class="md-nav__link">
    Restart the SSH service
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jenkins-configuration" title="Jenkins configuration" class="md-nav__link">
    Jenkins configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#publish-over-ssh-plugin" title="Publish over SSH plugin" class="md-nav__link">
    Publish over SSH plugin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-api-token" title="Generate API token" class="md-nav__link">
    Generate API token
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-maven-project" title="Create maven project" class="md-nav__link">
    Create maven project
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-build-trigger" title="Enable build trigger" class="md-nav__link">
    Enable build trigger
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-maven-commands" title="Build maven commands" class="md-nav__link">
    Build maven commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#after-build-steps" title="After build steps" class="md-nav__link">
    After build steps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-webhook-in-github" title="Create webhook in Github" class="md-nav__link">
    Create webhook in Github
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#try-push-code" title="Try push code" class="md-nav__link">
    Try push code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-global-security" title="Configure global security" class="md-nav__link">
    Configure global security
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-configuration" title="Deploy configuration" class="md-nav__link">
    Deploy configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shell-scripts" title="Shell scripts" class="md-nav__link">
    Shell scripts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#springboot-dockerfile" title="SpringBoot Dockerfile" class="md-nav__link">
    SpringBoot Dockerfile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-scripts" title="Build scripts" class="md-nav__link">
    Build scripts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#push-code" title="Push code" class="md-nav__link">
    Push code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../introduce-rollbar-and-slack-for-realtime-exception-alerts/" title="Introduce Rollbar and Slack for realtime exception alerts" class="md-nav__link">
      Introduce Rollbar and Slack for realtime exception alerts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../create--app-icon-launch-screen-for-flutter/" title="How to create an app icon and launch screen for flutter" class="md-nav__link">
      How to create an app icon and launch screen for flutter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../auto-generate-flutter-imgs/" title="Generate required flutter app screenshots for different devices" class="md-nav__link">
      Generate required flutter app screenshots for different devices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../flutter-app-distribution-for-testing/" title="How to make flutter app distribution for testing in Firebase" class="md-nav__link">
      How to make flutter app distribution  for testing in Firebase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../keycloak-traefik-k8s/" title="Play around with Keycloak in k8s" class="md-nav__link">
      Play around with Keycloak in k8s
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../developing-based-on-geoserver-restful-api/" title="Developing based on GeoServer restful api" class="md-nav__link">
      Developing based on GeoServer restful api
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../serve-raster-tiles-in-geoserver/" title="Serve raster tiles in GeoServer" class="md-nav__link">
      Serve raster tiles in GeoServer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../build-ceph-and-k8s-based-distributed-file-storage-system/" title="Build Ceph and Kubernetes based distributed file storage system" class="md-nav__link">
      Build Ceph and Kubernetes based distributed file storage system
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Tools 101
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Tools 101
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tools/hexo-get-started/" title="Hexo get started" class="md-nav__link">
      Hexo get started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tools/getting-started-with-mitmproxy/" title="Getting started on mitmproxy" class="md-nav__link">
      Getting started on mitmproxy
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Life Experience
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Life Experience
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../life/how-to-rent-a-house-in-australia/" title="How to rent a house in Australia" class="md-nav__link">
      How to rent a house in Australia
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../life/international-money-transfer-from-commanwealth-bank-to-china/" title="International money transfer from CommonWealth bank to China" class="md-nav__link">
      International money transfer from CommonWealth bank to China
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../life/a-detail-list-for-updating-address-when-moving/" title="A detailed list for updating address when moving" class="md-nav__link">
      A detailed list for updating address when moving
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#install" title="Install" class="md-nav__link">
    Install
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-docker" title="Install docker" class="md-nav__link">
    Install docker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-docker-compose" title="Install docker-compose" class="md-nav__link">
    Install docker-compose
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-jenkins-container" title="Create jenkins container" class="md-nav__link">
    Create jenkins container
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-ssh-key" title="Deploy SSH key" class="md-nav__link">
    Deploy SSH key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restart-the-ssh-service" title="Restart the SSH service" class="md-nav__link">
    Restart the SSH service
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jenkins-configuration" title="Jenkins configuration" class="md-nav__link">
    Jenkins configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#publish-over-ssh-plugin" title="Publish over SSH plugin" class="md-nav__link">
    Publish over SSH plugin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-api-token" title="Generate API token" class="md-nav__link">
    Generate API token
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-maven-project" title="Create maven project" class="md-nav__link">
    Create maven project
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-build-trigger" title="Enable build trigger" class="md-nav__link">
    Enable build trigger
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-maven-commands" title="Build maven commands" class="md-nav__link">
    Build maven commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#after-build-steps" title="After build steps" class="md-nav__link">
    After build steps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-webhook-in-github" title="Create webhook in Github" class="md-nav__link">
    Create webhook in Github
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#try-push-code" title="Try push code" class="md-nav__link">
    Try push code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-global-security" title="Configure global security" class="md-nav__link">
    Configure global security
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-configuration" title="Deploy configuration" class="md-nav__link">
    Deploy configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shell-scripts" title="Shell scripts" class="md-nav__link">
    Shell scripts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#springboot-dockerfile" title="SpringBoot Dockerfile" class="md-nav__link">
    SpringBoot Dockerfile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-scripts" title="Build scripts" class="md-nav__link">
    Build scripts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#push-code" title="Push code" class="md-nav__link">
    Push code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Continuous Integration with Jenkins and Docker</h1>
                
                <p>As Jenkins is one of the most popular CI tools on the market with over a thousand plugins, in this article, we are going to set up a CI pipeline for a SpringBoot application.
<!-- more --></p>
<h2 id="install">Install</h2>
<h3 id="install-docker">Install docker</h3>
<p>Start the docker service and login the docker hub.
<div class="codehilite"><pre><span></span>sudo curl -sSL https://get.docker.com/ <span class="p">|</span> sh
sudo service docker start
sudo docker login
</pre></div></p>
<h3 id="install-docker-compose">Install docker-compose</h3>
<div class="codehilite"><pre><span></span>sudo -i
curl -L https://github.com/docker/compose/releases/download/1.16.0-rc2/docker-compose-<span class="sb">`</span>uname -s<span class="sb">`</span>-<span class="sb">`</span>uname -m<span class="sb">`</span> &gt; /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
</pre></div>

<h3 id="create-jenkins-container">Create jenkins container</h3>
<p>Start Jenkins container and configure the user.
<div class="codehilite"><pre><span></span>sudo docker run --name jenkins -p <span class="m">8080</span>:8080 -p <span class="m">50000</span>:50000 -v /var/jenkins_home jenkins
</pre></div></p>
<h3 id="deploy-ssh-key">Deploy SSH key</h3>
<p>Use nsenter to attach the Jenkins container, and run commands in Jenkins container to generate ssh key, then the Jenkins server will have .ssh folder generated under ~, under the .ssh folder there are id_rsa (private key) and id_rsa.pub (public key).</p>
<p>Copy the content in id_rsa.pub, and go back to the remote server on which jenkins will SSH and execute shell scripts and deploy the application, and paste the content in ~/authorized_keys.
<div class="codehilite"><pre><span></span>sudo docker run -v /usr/local/bin:/target jpetazzo/nsenter

<span class="nv">PID</span><span class="o">=</span><span class="k">$(</span>sudo docker inspect --format <span class="o">{{</span>.State.Pid<span class="o">}}</span> jenkins<span class="k">)</span>
sudo nsenter --target <span class="nv">$PID</span> --mount --uts --ipc --net --pid

ssh-keygen -t rsa
<span class="c1">#Copy key</span>
</pre></div></p>
<h3 id="restart-the-ssh-service">Restart the SSH service</h3>
<p>Restart the ssh service in remote server, and create a folder to put scripts into it and modify the permission of it. For example: ~/agriculture-platform.
<div class="codehilite"><pre><span></span>service sshd restart
sudo mkdir ~/agriculture-platform/
sudo chmod <span class="m">777</span> ~/agriculture-platform/
</pre></div></p>
<h2 id="jenkins-configuration">Jenkins configuration</h2>
<h3 id="publish-over-ssh-plugin">Publish over SSH plugin</h3>
<p>Install the plugin "Publish over SSH" in Jenkins, and configure it, then test the connection.
<img alt="Publish over SSH plugin" src="/imgs/publish-over-ssh.png" /></p>
<h3 id="generate-api-token">Generate API token</h3>
<p>Login your jenkins with admin user and click the user on the right hand side, then select configure and generate a token here.
<img alt="Publish over SSH plugin" src="/imgs/jenkins-generate-token.png" /></p>
<h3 id="create-maven-project">Create maven project</h3>
<p>Create a maven project in Jenkins, configure the git URL and credentials for it.
<img alt="Create maven project" src="/imgs/jenkins-mvn-project.png" /></p>
<h3 id="enable-build-trigger">Enable build trigger</h3>
<p>Enable the remote build trigger token which is the above generated API token.
<img alt="Build trigger" src="/imgs/jenkins-build-trigger.png" /></p>
<h3 id="build-maven-commands">Build maven commands</h3>
<p>Configure the build step with maven build commands.
<img alt="Build goals" src="/imgs/jenkins-build-goal.png" /></p>
<h3 id="after-build-steps">After build steps</h3>
<p>Configure the after build step to SSH and copy the jar file to the remote server. Here we execute a shell script to deploy the SpringBoot application.
<img alt="Build publish" src="/imgs/jenkins-build-publish.png" /></p>
<h3 id="create-webhook-in-github">Create webhook in Github</h3>
<p>Login the Bitbucket or Github and enter your SpringBoot project, enter the Webhooks page, add new a webhook with Jenkins server info and your job name and the above generated API token.</p>
<p>The webhook will be invoked when you push any code to the master branch. The related jenkins project will receive this webhook request and execute the build job immediately.
<img alt="Create webhook" src="/imgs/github-webhook.png" /></p>
<h3 id="try-push-code">Try push code</h3>
<p>If we try to push the code to Bitbucket now, we will find a webhook request error in Webhooks page.
<img alt="Try push" src="/imgs/try-push.png" /></p>
<h3 id="configure-global-security">Configure global security</h3>
<p>We should login the Jenkins and configure the Global Security and enable the webhook in order to fix the above issue.
<img alt="Configure global security" src="/imgs/jenkins-global-security.png" /></p>
<h2 id="deploy-configuration">Deploy configuration</h2>
<h3 id="shell-scripts">Shell scripts</h3>
<p>Now Jenkins is configured to transfer the SpringBoot jar to "~/agriculture-platform" folder and run the shell script "~/agriculture-platform/rebuild.sh".</p>
<p>Login the remote server, we create "agriculture-platform" folder under ~, and create Dockerfile and rebuild.sh under it.
<img alt="Shell scripts" src="/imgs/shell-scripts.png" /></p>
<h3 id="springboot-dockerfile">SpringBoot Dockerfile</h3>
<p>The Dockerfile content is as bellow, it creates a docker image and copy the jar into it, then run the jar.
<div class="codehilite"><pre><span></span><span class="k">FROM</span><span class="s"> hustakin/java8</span>
<span class="k">MAINTAINER</span><span class="s"> Frankie Fan &quot;hustakin@gmail.com&quot;</span>

<span class="k">VOLUME</span><span class="s"> /tmp</span>
<span class="k">ADD</span> agriculture-platform.jar agriculture-platform.jar
<span class="k">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&quot;java&quot;</span><span class="p">,</span><span class="s2">&quot;-Djava.security.egd=file:/dev/./urandom&quot;</span><span class="p">,</span><span class="s2">&quot;-Dspring.profiles.active=docker&quot;</span><span class="p">,</span><span class="s2">&quot;-jar&quot;</span><span class="p">,</span><span class="s2">&quot;/agriculture-platform.jar&quot;</span><span class="p">]</span>
<span class="k">EXPOSE</span><span class="s"> 8001 8002</span>
</pre></div></p>
<h3 id="build-scripts">Build scripts</h3>
<p>The rebuild.sh content is as bellow, it creates a docker image and copy the jar into it, then run the jar.
<div class="codehilite"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nb">cd</span> ~/docker/agriculture-platform/
sudo docker stop agriculture
sudo docker rm agriculture
sudo docker build --no-cache -t<span class="o">=</span><span class="s2">&quot;hustakin/test&quot;</span> .
sudo docker run -p <span class="m">80</span>:80 -p <span class="m">443</span>:443 -v /data/log/dev:/logs --name agriculture --restart<span class="o">=</span>always -d hustakin/test --param<span class="o">=</span>hello
</pre></div></p>
<h3 id="push-code">Push code</h3>
<p>After all the above configurations, now we completely finish the CI process. When we push the code to Bitbucket or Github, the Jenkins will start to maven build the code and transfer the jar to the remote server, then the remote server will rebuild the SpringBoot docker image and recreate the docker container.
<img alt="CI build" src="/imgs/ci-build.png" /></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../setup-jenkins-pipeline-in-kubernetes/" title="Setup Jenkins Pipeline and Blue Ocean in Kubernetes" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Setup Jenkins Pipeline and Blue Ocean in Kubernetes
              </span>
            </div>
          </a>
        
        
          <a href="../introduce-rollbar-and-slack-for-realtime-exception-alerts/" title="Introduce Rollbar and Slack for realtime exception alerts" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Introduce Rollbar and Slack for realtime exception alerts
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 Frankie Fan
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/hustakin" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://linkedin.com/in/hustakin" class="md-footer-social__link fa fa-linkedin"></a>
    
      <a href="https://instagram.com/hustakin" class="md-footer-social__link fa fa-instagram"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>